<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.52">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Analyses the feasibility of Wi-Fi CSI-based HAR systems in real-world applications.">

<title>Looking into the Future: Wi-Fi CSI based HAR – Human Activity Recognition with Consumer Devices and Real-Life Perspectives</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./05.1_localized-har.html" rel="next">
<link href="./04.3_energy-consumption.html" rel="prev">
<link href="./figs/book.svg" rel="icon" type="image/svg+xml">
<script src="site_libs/quarto-listing/list.min.js"></script>
<script src="site_libs/quarto-listing/quarto-listing.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="site_libs/quarto-contrib/add-code-files-1.0.0/add-code-files.css" rel="stylesheet">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-contents .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: ['listing-title','listing-author','listing-image','listing-description',{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: ["listing-title","listing-author","listing-image","listing-description"],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-contents'] = new List('listing-contents', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css?family=Roboto:400,500,700" type="text/css">
<link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css?family=Roboto+Mono" type="text/css">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./05_wifi-csi.html">Wi-Fi CSI based HAR</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./figs/uji-logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Human Activity Recognition with Consumer Devices and Real-Life Perspectives</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/matey97/thesis" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./02_materials-methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Materials &amp; Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.1_collection-tools.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Data collection libraries</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.2_dataset.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Smartphone and smartwatch HAR dataset</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.3_methods.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Common methods</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./03_analysis-har.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multidimensional Analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.1_training-data.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Impact of the amount of training data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.2_data-sources.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Statistical comparison of data sources performance</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.3_models.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Statistical comparison of models performance</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./04_tug.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">HAR in mHealth: TUG test</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.1_splitting-approach.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Splitting approach analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.2_system-reliability.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">System’s agreement and reliabilitty</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.3_energy-consumption.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Energy consumption</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./05_wifi-csi.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Wi-Fi CSI based HAR</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.1_localized-har.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Localized HAR based on Wi-Fi CSI</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.2_methods-validation.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Validation of employed methods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05.3_csi-stability.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Temporal stability of Wi-Fi CSI data from ESP32 microcontrollers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_conclusions.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Conclusions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./reference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reference</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter2.data_loading.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter2.data_loading</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter2.exploration.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter2.exploration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter2.visualization.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter2.visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter3.pipeline.01_data-processing.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter3.pipeline.01_data-processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter3.pipeline.02_hyperparameter-optimization.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter3.pipeline.02_hyperparameter-optimization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter3.pipeline.03_incremental-loso.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter3.pipeline.03_incremental-loso</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter3.analysis.data_loading.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter3.analysis.data_loading</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter3.analysis.model.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter3.analysis.model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter3.analysis.statistical_tests.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter3.analysis.statistical_tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter3.analysis.visualization.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter3.analysis.visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter4.pipeline.01_relabel.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter4.pipeline.01_relabel</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter4.pipeline.02_splitting-evaluation.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter4.pipeline.02_splitting-evaluation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter4.analysis.data_loading.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter4.analysis.data_loading</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter4.analysis.statistical_tests.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter4.analysis.statistical_tests</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter4.analysis.tug_results_processing.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter4.analysis.tug_results_processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter4.analysis.visualization.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter4.analysis.visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter4.analysis.battery.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter4.analysis.battery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter5.pipeline.01_1_preliminar-dataset-processing.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter5.pipeline.01_1_preliminar-dataset-processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter5.pipeline.01_2_stanwifi-processing.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter5.pipeline.01_2_stanwifi-processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter5.pipeline.01_3_multienvironment-processing.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter5.pipeline.01_3_multienvironment-processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter5.pipeline.01_4_lodo-dataset-processing.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter5.pipeline.01_4_lodo-dataset-processing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter5.pipeline.02_hyperparameter-optimization.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter5.pipeline.02_hyperparameter-optimization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter5.pipeline.03_1_multiple-evaluations.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter5.pipeline.03_1_multiple-evaluations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter5.pipeline.03_2_cross-validation.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter5.pipeline.03_2_cross-validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter5.pipeline.03_3_lodo.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter5.pipeline.03_3_lodo</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter5.analysis.reports.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">chapter5.analysis.reports</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reference/chapter5.analysis.visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"></span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tools</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#methodology-preliminar-localized-har-experiment" id="toc-methodology-preliminar-localized-har-experiment" class="nav-link active" data-scroll-target="#methodology-preliminar-localized-har-experiment">Methodology: preliminar localized HAR experiment</a>
  <ul>
  <li><a href="#data-collection" id="toc-data-collection" class="nav-link" data-scroll-target="#data-collection">Data collection</a></li>
  <li><a href="#sec-csi_data_prep" id="toc-sec-csi_data_prep" class="nav-link" data-scroll-target="#sec-csi_data_prep">Data preparation</a></li>
  <li><a href="#sec-csi_model" id="toc-sec-csi_model" class="nav-link" data-scroll-target="#sec-csi_model">HAR classifier</a></li>
  <li><a href="#sec-csi_exp_procedure" id="toc-sec-csi_exp_procedure" class="nav-link" data-scroll-target="#sec-csi_exp_procedure">Experimental procedure</a></li>
  </ul></li>
  <li><a href="#investigating-the-causes-of-failure" id="toc-investigating-the-causes-of-failure" class="nav-link" data-scroll-target="#investigating-the-causes-of-failure">Investigating the causes of failure</a>
  <ul>
  <li><a href="#validation-of-method-on-public-datasets" id="toc-validation-of-method-on-public-datasets" class="nav-link" data-scroll-target="#validation-of-method-on-public-datasets">Validation of method on public datasets</a>
  <ul class="collapse">
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">Methodology</a></li>
  </ul></li>
  <li><a href="#validation-of-alternative-method-in-the-collected-dataset" id="toc-validation-of-alternative-method-in-the-collected-dataset" class="nav-link" data-scroll-target="#validation-of-alternative-method-in-the-collected-dataset">Validation of alternative method in the collected dataset</a>
  <ul class="collapse">
  <li><a href="#methodology-1" id="toc-methodology-1" class="nav-link" data-scroll-target="#methodology-1">Methodology</a></li>
  </ul></li>
  <li><a href="#verification-of-the-stability-of-the-csi-signal" id="toc-verification-of-the-stability-of-the-csi-signal" class="nav-link" data-scroll-target="#verification-of-the-stability-of-the-csi-signal">Verification of the stability of the CSI signal</a>
  <ul class="collapse">
  <li><a href="#methodology-2" id="toc-methodology-2" class="nav-link" data-scroll-target="#methodology-2">Methodology</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/matey97/thesis/blob/main/05_wifi-csi.qmd" target="blank" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div><div class="quarto-other-links"><h2>Other Links</h2><ul><li><a href="https://doi.org/10.1109/IPIN57070.2023.10332214" target="blank"><i class="bi bi-journal-bookmark-fill"></i>IPIN paper</a></li></ul></div><div class="quarto-code-links"><h2>Code Links</h2><ul><li><a href="https://github.com/matey97/thesis/blob/main/libs/chapter5/pipeline/01_1_preliminar-dataset-processing.py" target="blank"><i class="bi bi-file-code"></i>01_1_preliminar-dataset-processing.py</a></li><li><a href="https://github.com/matey97/thesis/blob/main/libs/chapter5/pipeline/01_2_stanwifi-processing.py" target="blank"><i class="bi bi-file-code"></i>01_2_stanwifi-processing.py</a></li><li><a href="https://github.com/matey97/thesis/blob/main/libs/chapter5/pipeline/01_3_multienvironment-processing.py" target="blank"><i class="bi bi-file-code"></i>01_3_multienvironment-processing.py</a></li><li><a href="https://github.com/matey97/thesis/blob/main/libs/chapter5/pipeline/01_4_lodo-dataset-processing.py" target="blank"><i class="bi bi-file-code"></i>01_4_lodo-dataset-processing.py</a></li><li><a href="https://github.com/matey97/thesis/blob/main/libs/chapter5/pipeline/02_hyperparameter-optimization.py" target="blank"><i class="bi bi-file-code"></i>02_hyperparameter-optimization.py</a></li><li><a href="https://github.com/matey97/thesis/blob/main/libs/chapter5/pipeline/03_1_multiple-evaluations.py" target="blank"><i class="bi bi-file-code"></i>03_1_multiple-evaluations.py</a></li><li><a href="https://github.com/matey97/thesis/blob/main/libs/chapter5/pipeline/03_2_cross-validation.py" target="blank"><i class="bi bi-file-code"></i>03_2_cross-validation.py</a></li><li><a href="https://github.com/matey97/thesis/blob/main/libs/chapter5/pipeline/03_3_lodo.py" target="blank"><i class="bi bi-file-code"></i>03_3_lodo.py</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Looking into the Future: Wi-Fi CSI based HAR</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Inertial-based HAR with smartphones and smartwatches has proven its feasibility for real-life applications and state-of-the-art performance. Over the last years, another stream of research has emerged to free users from carrying any type of device: the Wi-Fi CSI (Channel State Information). The key point of the Wi-Fi CSI-based systems is that they employ a Wi-Fi infrastructure enabling device-free sensing (i.e., users do not have to wear any device). In addition, the CSI can be used for diverse tasks, such as HAR and indoor positioning, which would be a major challenge using inertial-based sensors. In this chapter, we analyse the feasibility of a Wi-Fi CSI-based HAR and positioning system using a consumer router and an ESP32 microcontroller, evaluating it by simulating real-life conditions. Preliminary results show a clear instability of the CSI data, thus being unfeasible for real-life applications with the employed devices.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Plotly loading issue
</div>
</div>
<div class="callout-body-container callout-body">
<p>This page contains Plotly interactive figures. Sometimes, the figures might not load properly and show a blank image. <strong>Reloading the page might solve the loading issue</strong>.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The contents on this section correspond with the Chapter 5 of the dissertation document and constitute an extension of the work “Temporal Stability on Human Activity Recognition based on Wi-Fi CSI” <span class="citation" data-cites="matey2023csi">(<a href="references.html#ref-matey2023csi" role="doc-biblioref">Matey-Sanz, Torres-Sospedra, and Moreira 2023</a>)</span> presented in the <span class="math inline">\(13^{th}\)</span> International Conference on Indoor Positioning and Indoor Navigation (IPIN).</p>
</div>
</div>
<section id="methodology-preliminar-localized-har-experiment" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="methodology-preliminar-localized-har-experiment">Methodology: preliminar localized HAR experiment</h2>
<section id="data-collection" class="level3">
<h3 class="anchored" data-anchor-id="data-collection">Data collection</h3>
<p>A dataset is collected using a TP-Link Archer C80 router (one TX antenna) and a SparkFun Thing Plus ESP32-S2 WROOM (one RX antenna) connected to a laptop. The TX and RX were separated by <span class="math inline">\(5\)</span> meter in Line of Sight (LOS) condition, with two chairs placed in between them, at <span class="math inline">\(0.5\)</span> meter from each device. Although the chair partially blocks the signal, we consider the setup to be in LOS condition since no heavy obstacles (e.g., walls) are blocking the signal.</p>
<p>The TX device was configured to work with the standard IEEE 802.11n operating in the channel <span class="math inline">\(6\)</span>. The RX device was configured to establish a connection with the TX, send ping requests at <span class="math inline">\(100\)</span>Hz, and extract the Wi-Fi CSI information from the HT-LTF subcarriers (<span class="math inline">\(64\)</span>, <span class="math inline">\(56\)</span> non-null) of the ping responses.</p>
<p><a href="#fig-collection_env" class="quarto-xref">Figure&nbsp;<span>1</span></a> depicts the data collection process. It consisted of one subject moving from one chair to the other repeatedly, collecting data for the activities widely used along this thesis: <code>SEATED</code>, <code>STANDING_UP</code>, <code>WALKING</code>, <code>TURNING</code> and <code>SITTING_DOWN|</code>. Since the subject performed the activities in both directions (i.e., from TX to RX and vice versa), the activities were labelled accordingly (e.g., <code>SEATED_TX/RX</code>, <code>WALKING_TX/RX</code>, etc.) adding a localization component to them.</p>
<div id="fig-collection_env" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-collection_env-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figs/chapter5/csi-collection-env.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;1: Data collection environment and activities performed"><img src="figs/chapter5/csi-collection-env.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-collection_env-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Data collection environment and activities performed
</figcaption>
</figure>
</div>
<p><a href="#fig-collection_procedure" class="quarto-xref">Figure&nbsp;<span>2</span></a> depicts the data collection strategy, which was spaced out over time to explore potential degradation of CSI data over time. The following datasets were collected:</p>
<div id="fig-collection_procedure" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-collection_procedure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figs/chapter5/csi-collection-procedure.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure&nbsp;2: Data collection procedure"><img src="figs/chapter5/csi-collection-procedure.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-collection_procedure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Data collection procedure
</figcaption>
</figure>
</div>
<ul>
<li><code>D1</code>: The subject performed the sequence of activities <span class="math inline">\(20\)</span> times (<span class="math inline">\(10\)</span> in each direction).</li>
<li><code>D2</code>: After <span class="math inline">\(10\)</span> minutes of collecting <code>D1</code>, the subject performed again the sequence of activities <span class="math inline">\(4\)</span> times (<span class="math inline">\(2\)</span> in each direction).</li>
<li><code>D3</code>: After <span class="math inline">\(20\)</span> minutes of collecting <code>D2</code>, the subject performed again the sequence of activities <span class="math inline">\(4\)</span> times.</li>
<li><code>D4</code>: After <span class="math inline">\(60\)</span> minutes of collecting <code>D3</code>, the subject performed again the sequence of activities <span class="math inline">\(4\)</span> times.</li>
</ul>
<p><a href="#tbl-csi_collected_samples" class="quarto-xref">Table&nbsp;<span>1</span></a> shows the number of CSI samples collected for each activity and dataset.</p>
<div class="quarto-embed-nb-cell" data-notebook="/Users/miguel/Documents/Projects/thesis/05.1.1_data-exploration.ipynb" data-notebook-title="Data exploration" data-notebook-cellid="cell-tbl-csi_collected_samples">
<div class="cell" data-execution_count="3">
<div id="tbl-csi_collected_samples" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="3">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-csi_collected_samples-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Collected CSI samples fir each activity and dataset
</figcaption>
<div aria-describedby="tbl-csi_collected_samples-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">D1</th>
<th data-quarto-table-cell-role="th">D2</th>
<th data-quarto-table-cell-role="th">D3</th>
<th data-quarto-table-cell-role="th">D4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">SEATED_RX</td>
<td>2864.0</td>
<td>614.0</td>
<td>593.0</td>
<td>569.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">STANDING_UP_RX</td>
<td>1305.0</td>
<td>293.0</td>
<td>276.0</td>
<td>269.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">WALKING_TX</td>
<td>2285.0</td>
<td>455.0</td>
<td>466.0</td>
<td>469.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">TURN_TX</td>
<td>1133.0</td>
<td>222.0</td>
<td>238.0</td>
<td>208.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">SITTING_DOWN_TX</td>
<td>1538.0</td>
<td>351.0</td>
<td>301.0</td>
<td>315.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SEATED_TX</td>
<td>2890.0</td>
<td>415.0</td>
<td>504.0</td>
<td>499.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">STANDING_UP_TX</td>
<td>1289.0</td>
<td>291.0</td>
<td>271.0</td>
<td>267.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">WALKING_RX</td>
<td>2470.0</td>
<td>503.0</td>
<td>504.0</td>
<td>510.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">TURN_RX</td>
<td>997.0</td>
<td>194.0</td>
<td>228.0</td>
<td>175.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">SITTING_DOWN_RX</td>
<td>1524.0</td>
<td>353.0</td>
<td>304.0</td>
<td>301.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Total</td>
<td>18295.0</td>
<td>3691.0</td>
<td>3685.0</td>
<td>3582.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-csi_data_prep" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sec-csi_data_prep">Data preparation</h3>
<p>First, from the raw CSI data, the signal amplitude values of each subcarrier where obtained using the equation <span class="math display">\[
amplitude_{i} = \sqrt{real_{i}^2 + imaginary_{i}^2},
\]</span> where <span class="math inline">\(real_{i}\)</span> and <span class="math inline">\(imaginary_{i}\)</span> are the corresponding components of the complex number associated with the <span class="math inline">\(i^{th}\)</span> subcarrier. The phase of the signal was discarded.</p>
<p>Next, the dataset was arranged in windows of <span class="math inline">\(50\)</span> samples with a <span class="math inline">\(50\%\)</span> overlap. Then, each window was processed using the following techniques:</p>
<ul>
<li>The DBSCAN clustering algorithm <span class="citation" data-cites="ester1996density">(<a href="references.html#ref-ester1996density" role="doc-biblioref">Ester et al. 1996</a>)</span> was employed to detect outliers and replace them using the average value of the <span class="math inline">\(5\)</span> previous and posterior values.</li>
<li>A <span class="math inline">\(2\)</span>-level <em>discrete wavelet transform</em> was used to decompose the signals, apply threshold-based filtering on the <em>detail</em> coefficients and reconstruct the signal with the <em>inverse discrete wavelet transform</em>.</li>
</ul>
<p><a href="#fig-csi_data_before" class="quarto-xref">Figure&nbsp;<span>3</span></a> and <a href="#fig-csi_data_after" class="quarto-xref">Figure&nbsp;<span>4</span></a> depict the raw (after amplitude extraction) and processed CSI data of the first two sequences of <code>D1</code>.</p>
<div class="quarto-embed-nb-cell page-columns page-full" data-notebook="/Users/miguel/Documents/Projects/thesis/05.1.1_data-exploration.ipynb" data-notebook-title="Data exploration" data-notebook-cellid="cell-fig-csi_data_before">
<div id="cell-fig-csi_data_before" class="cell column-page-right" data-execution_count="5">
<div id="fig-csi_data_before" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-csi_data_before-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="620" src="iframe_figures/figure_5.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-csi_data_before-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: First two executions of the D1 dataset before applying the data processing techniques.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-embed-nb-cell page-columns page-full" data-notebook="/Users/miguel/Documents/Projects/thesis/05.1.1_data-exploration.ipynb" data-notebook-title="Data exploration" data-notebook-cellid="cell-fig-csi_data_after">
<div id="cell-fig-csi_data_after" class="cell column-page-right" data-execution_count="6">
<div id="fig-csi_data_after" class="cell-output cell-output-display quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-csi_data_after-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<iframe scrolling="no" width="100%" height="620" src="iframe_figures/figure_6.html" frameborder="0" allowfullscreen=""></iframe>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-csi_data_after-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: First two executions of the D1 dataset after applying the data processing techniques.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The script employed to execute this process is <code>01_1_preliminar-dataset-processing.py</code> with the flag <code>--method proposed</code>.</p>
<div data-add-from="libs/chapter5/pipeline/01_1_preliminar-dataset-processing.py" data-code-fold="true" data-code-filename="01_1_preliminar-dataset-processing.py">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Data preprocessing script for preliminar dataset.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">Processes the raw data by: arange samples in windows and process them using 1) DBSCAN for outlier detection</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">and 2-level DWT for threshold based filtering or 2) Choi et al. method.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">**Example**:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">    $ python 01_1_preliminar-dataset-processing.py </span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">        --input_data_path &lt;PATH_OF_RAW_DATA&gt; </span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">        --windowed_data_path &lt;PATH_TO_STORE_RESULTS&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">        --method &lt;PROCESSING_METHOD&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">        --window_size &lt;WINDOW_SIZE&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">        --window_overlap &lt;WINDOW_OVERLAP&gt;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">"../../.."</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> alive_progress <span class="im">import</span> alive_bar</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.processing <span class="im">import</span> proposed_method, choi_method</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.raw_data_loading <span class="im">import</span> load_labelled_data</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>WINDOW_SIZE <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>WINDOW_OVERLAP <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_windows(executions_amplitudes, executions_labels, window_size, window_overlap):</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    win <span class="op">=</span> {}</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    win_labels <span class="op">=</span> {}</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> execution_id <span class="kw">in</span> executions_amplitudes:</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        amplitudes <span class="op">=</span> executions_amplitudes[execution_id]</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        exec_labels <span class="op">=</span> executions_labels[execution_id]</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> amplitudes</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> data.shape[<span class="dv">1</span>] <span class="op">//</span> window_overlap</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        windows <span class="op">=</span> []</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        windows_labels <span class="op">=</span> []</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, (n<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span> window_overlap, window_overlap):</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i<span class="op">+</span>window_size <span class="op">&gt;</span> data.shape[<span class="dv">1</span>]:</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>            window_labels <span class="op">=</span> exec_labels[i:i<span class="op">+</span>window_size]</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>            values, counts <span class="op">=</span> np.unique(window_labels, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(values) <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>            windows.append(data[:,i:i<span class="op">+</span>window_size])</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>            windows_labels.append(values[counts.argmax()])</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        windows <span class="op">=</span> np.array(windows)</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        windows_labels <span class="op">=</span> np.array(windows_labels)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        win[execution_id] <span class="op">=</span> windows</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        win_labels[execution_id] <span class="op">=</span> windows_labels</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> win, win_labels</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_windows(executions_windows, processing_function):</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    processed_windows <span class="op">=</span> {}</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    executions_ids <span class="op">=</span> executions_windows.keys()</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> alive_bar(<span class="bu">len</span>(executions_ids), title<span class="op">=</span><span class="ss">f'Processing windows'</span>, force_tty<span class="op">=</span><span class="va">True</span>) <span class="im">as</span> progress_bar:</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> execution_id <span class="kw">in</span> executions_ids:</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>            proc_windows <span class="op">=</span> []</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>            windows <span class="op">=</span> executions_windows[execution_id]</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> window <span class="kw">in</span> windows:</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>                proc_windows.append(processing_function(window))</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>            processed_windows[execution_id] <span class="op">=</span> np.array(proc_windows)</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>            progress_bar()</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> processed_windows</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_windowed_data(data, labels, directory):</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(directory):</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>        os.makedirs(directory)</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    x_file_path <span class="op">=</span> os.path.join(directory, <span class="st">'</span><span class="sc">{0}</span><span class="st">-x.npy'</span>)</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    y_file_path <span class="op">=</span> os.path.join(directory, <span class="st">'</span><span class="sc">{0}</span><span class="st">-y.npy'</span>)</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> execution_id <span class="kw">in</span> data:</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> data[execution_id]</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> labels[execution_id]</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>        np.save(x_file_path.<span class="bu">format</span>(execution_id), x)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>        np.save(y_file_path.<span class="bu">format</span>(execution_id), y)</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser()</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--input_data_path'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Path of input data'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--windowed_data_path'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Path to store windowed data'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--method'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Processing method'</span>, required<span class="op">=</span><span class="va">True</span>, choices<span class="op">=</span>[<span class="st">'proposed'</span>, <span class="st">'choi'</span>])</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>    processing_function <span class="op">=</span> proposed_method <span class="cf">if</span> args.method <span class="op">==</span> <span class="st">'proposed'</span> <span class="cf">else</span> choi_method</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> dataset <span class="kw">in</span> [<span class="st">'D1'</span>, <span class="st">'D2'</span>, <span class="st">'D3'</span>, <span class="st">'D4'</span>]:</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Processing dataset </span><span class="sc">{</span>dataset<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        executions_amp, labels <span class="op">=</span> load_labelled_data(os.path.join(args.input_data_path, dataset))</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>        windows, windows_labels <span class="op">=</span> create_windows(executions_amp, labels, WINDOW_SIZE, WINDOW_OVERLAP)</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>        windows_processed <span class="op">=</span> process_windows(windows, processing_function)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        save_windowed_data(windows_processed, windows_labels, os.path.join(args.windowed_data_path, dataset))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
<section id="sec-csi_model" class="level3">
<h3 class="anchored" data-anchor-id="sec-csi_model">HAR classifier</h3>
<p>Since a previous section showed that the CNN was the best-performing model from the selected ones, in this chapter we keep using a CNN architecture despite the domain of the input data being different. The <strong>Grid search</strong> technique was used to determine the best hyperparameters for the selected architecture. The process was configured to train and evaluate each combination five times using the Adam optimizer during <span class="math inline">\(50\)</span> epochs with a batch size of <span class="math inline">\(32\)</span> windows. The process was executed in two phases to reduce the computational cost: 1) optimization of layers and learning hyperparameters, and 2) optimization of the number of layers. <a href="#tbl-csi_hyperparameters_cnn" class="quarto-xref">Table&nbsp;<span>2</span></a> contains the best combination of hyperparameters</p>
<div class="quarto-embed-nb-cell" data-notebook="/Users/miguel/Documents/Projects/thesis/05.1.2_grid-search.ipynb" data-notebook-title="Grid Search results" data-notebook-cellid="cell-tbl-csi_hyperparameters_cnn">
<div class="cell" data-execution_count="4">
<div id="tbl-csi_hyperparameters_cnn" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="4">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-csi_hyperparameters_cnn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Best combination of hyperparameters.
</figcaption>
<div aria-describedby="tbl-csi_hyperparameters_cnn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">conv</td>
<td>2D</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">input_cnn_filters</td>
<td>128</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">input_cnn_filter_size_x</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">input_cnn_filter_size_y</td>
<td>25</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">batch_norm</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max_pool</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">extra_cnn</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">dropout</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">n_dense</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">dense_laye</td>
<td>512</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">lr</td>
<td>0.0001</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The script employed to execute the Grid Search is <code>02_hyperparameter-optimization.py</code> with the flag <code>--model cnn</code>.</p>
<div data-add-from="libs/chapter5/pipeline/02_hyperparameter-optimization.py" data-code-fold="true" data-code-filename="02_hyperparameter-optimization.py">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Hyperparameters Grid Search script.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">Performs an hyperparameter Grid Search on the specified model. The selected hyperparameters for the search</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">can be found in `tuning_configuration.py`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">**Example**:</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">    $ python 02_hyperparameter-optimization.py </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">        --data_dir &lt;PATH_OF_DATA&gt; </span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">        --model &lt;MLP,CNN&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">        --phase &lt;initial,extra-layers&gt;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">        --batch_size &lt;BATCH_SIZE&gt;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">        --epochs &lt;EPOCHS&gt;</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">        --executions &lt;EXECUTIONS&gt;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">"../../.."</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.data_loading <span class="im">import</span> load_data</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.data_grouping <span class="im">import</span> combine_windows</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.hyperparameters_tuning <span class="im">import</span> get_model_builder, create_tuner, tune, get_tuning_summary</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.tuning_configuration <span class="im">import</span> get_tuning_configuration</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.common.data_loading <span class="im">import</span> ground_truth_to_categorical</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.common.utils <span class="im">import</span> save_json, set_seed</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>TUNING_DIR <span class="op">=</span> <span class="st">'GRID_SEARCH_</span><span class="sc">{0}</span><span class="st">'</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>TUNING_SUMMARY_FILE <span class="op">=</span> <span class="st">'summary.json'</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>N_EXECUTIONS <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>MAPPING <span class="op">=</span> {</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SEATED_RX'</span>: <span class="dv">0</span>, </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">'STANDING_UP_RX'</span>: <span class="dv">1</span>, </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WALKING_TX'</span>: <span class="dv">2</span>, </span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TURN_TX'</span>: <span class="dv">3</span>, </span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SITTING_DOWN_TX'</span>: <span class="dv">4</span>, </span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SEATED_TX'</span>: <span class="dv">5</span>, </span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">'STANDING_UP_TX'</span>: <span class="dv">6</span>,</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WALKING_RX'</span>: <span class="dv">7</span>,</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TURN_RX'</span>: <span class="dv">8</span>,</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SITTING_DOWN_RX'</span>: <span class="dv">9</span>,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tune_model(data, model_type, batch_size, epochs, n_executions, phase):</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    set_seed()    </span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    model_builder <span class="op">=</span> get_model_builder(model_type)</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    optimizing_layers <span class="op">=</span> phase <span class="op">==</span> <span class="st">'extra-layers'</span> </span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> source, (x, y) <span class="kw">in</span> data.items():</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        features_dimension <span class="op">=</span> x.shape[<span class="dv">1</span>]</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        tuning_configuration <span class="op">=</span> get_tuning_configuration(model_type, source <span class="cf">if</span> optimizing_layers <span class="cf">else</span> <span class="va">None</span>)</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>        tuning_configuration[<span class="st">'features_dimension'</span>] <span class="op">=</span> features_dimension</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        tuning_project <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>model_type<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>source<span class="sc">}{</span><span class="st">"_layers"</span> <span class="cf">if</span> optimizing_layers <span class="cf">else</span> <span class="st">""</span><span class="sc">}</span><span class="ss">'</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Tuning </span><span class="sc">{</span>model_type<span class="sc">}</span><span class="ss"> model with </span><span class="sc">{</span>source<span class="sc">}</span><span class="ss"> data'</span>)</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>        tuner <span class="op">=</span> create_tuner(</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>            model_builder, </span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>            n_executions, </span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>            tuning_configuration, </span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>            TUNING_DIR.<span class="bu">format</span>(phase), </span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>            tuning_project</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        tuner <span class="op">=</span> tune(tuner, x, y, epochs, batch_size)</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        save_tuning_summary(tuner, os.path.join(TUNING_DIR, tuning_project))</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_tuning_summary(tuner, tuning_dir):</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    save_json(get_tuning_summary(tuner), tuning_dir, TUNING_SUMMARY_FILE)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser()</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--data_dir'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'data directory'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--model'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'optimize hyperparameters for selected model'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, choices<span class="op">=</span>[<span class="st">'mlp'</span>, <span class="st">'cnn'</span>])</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--phase'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'tuning phase: &lt;initial&gt; to tune layer hyperparameters and &lt;extra-layers&gt; to tune number of layers'</span> , <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, choices<span class="op">=</span>[<span class="st">'initial'</span>, <span class="st">'extra-layers'</span>])</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--batch_size'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'training batch size'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span>BATCH_SIZE)</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--epochs'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'training epochs'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span>EPOCHS)</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--executions'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'executions per trial'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span>N_EXECUTIONS)</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    d1_windows, d1_labels <span class="op">=</span> load_data(args.data_dir)</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> ground_truth_to_categorical(d1_labels, MAPPING)    </span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> combine_windows(d1_windows, y)</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x.shape)</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">'csi'</span>: (x, y)</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>    tune_model(data, args.model, args.batch_size, args.epochs, args.executions, args.phase)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
<section id="sec-csi_exp_procedure" class="level3">
<h3 class="anchored" data-anchor-id="sec-csi_exp_procedure">Experimental procedure</h3>
<p><a href="#fig-csi_evaluation" class="quarto-xref">Figure&nbsp;<span>5</span></a> depicts the three different evaluation approaches employed to determine the performance of a Wi-Fi CSI model for localized HAR and study the stability of the CSI data over time.</p>
<div id="fig-csi_evaluation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-csi_evaluation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="figs/chapter5/csi-evaluation.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure&nbsp;5: Evaluation procedures. First, 10 K-fold cross-validation is used with D1. Then, D1 is split in D1T and D1E (80\%/20\%) maintaining temporal dependencies. Finally, datasets D2, D3 and D4 evaluate a model trained with D1T."><img src="figs/chapter5/csi-evaluation.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-csi_evaluation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Evaluation procedures. First, <span class="math inline">\(10\)</span> <em>K</em>-fold cross-validation is used with <code>D1</code>. Then, <code>D1</code> is split in <code>D1T</code> and <code>D1E</code> (<span class="math inline">\(80\%/20\%\)</span>) maintaining temporal dependencies. Finally, datasets <code>D2</code>, <code>D3</code> and <code>D4</code> evaluate a model trained with <code>D1T</code>.
</figcaption>
</figure>
</div>
<ul>
<li><strong><em>K</em>-fold cross-validation</strong>: classical procedure widely employed in the literature for model evaluation. It consists of splitting the available data into <span class="math inline">\(K\)</span> parts, where each <span class="math inline">\(k_{i}\)</span> part is used to evaluate a model trained with the remaining <span class="math inline">\(K-1\)</span> parts. We employ this evaluation approach with the <code>D1</code> dataset and <span class="math inline">\(K=10\)</span>.</li>
<li><strong>Maintaining the temporal dependencies</strong>: the <em>K</em>-fold cross-validation is not the most appropriate evaluation approach when dealing with time series since the temporality of the data is altered. To maintain that temporality, the first <span class="math inline">\(16\)</span> sequences of activities (<span class="math inline">\(80\%\)</span> of data) from <code>D1</code> are used for training and the remaining (last) <span class="math inline">\(4\)</span> sequences (<span class="math inline">\(20\%\)</span>) for evaluation. These subsets of <code>D1</code> are named <code>D1T</code> (training) and <code>D1E</code> (evaluation). This is a basic approach to investigate the stability of the data.</li>
<li><strong>Effect of time</strong>: the model trained with <code>D1T</code> is evaluated using the data from <code>D2</code>, <code>D3</code> and <code>D4</code>. This approach allows to analyse the variation of the classification performance in different time frames (<span class="math inline">\(10\)</span>, <span class="math inline">\(30\)</span> and <span class="math inline">\(90\)</span> minutes after <code>D1</code>) and therefore, to determine the stability of the CSI data.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The script employed to execute this process is <code>03_1_multiple-evaluations.py</code> with the flag <code>--model cnn</code>.</p>
<div data-add-from="libs/chapter5/pipeline/03_1_multiple-evaluations.py" data-code-fold="true" data-code-filename="03_1_multiple-evaluations.py">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Multiple evaluation script</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">Performs a cross-validation and an evaluation with different subsets collected at different time frames.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">**Example**:</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">    $ python 03_1_multiple_evaluations.py </span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">        --data_dir &lt;PATH_OF_DATA&gt; </span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">        --reports_dir &lt;PATH_TO_STORE_REPORTS&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">        --model &lt;MLP,CNN&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">"../../.."</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.data_loading <span class="im">import</span> load_data</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.data_grouping <span class="im">import</span> combine_windows, split_train_test</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.ml <span class="im">import</span> cross_validation, evaluate_model</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.common.data_loading <span class="im">import</span> ground_truth_to_categorical</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.common.utils <span class="im">import</span> save_json, set_seed</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>MAPPING <span class="op">=</span> {</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SEATED_RX'</span>: <span class="dv">0</span>, </span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'STANDING_UP_RX'</span>: <span class="dv">1</span>, </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WALKING_TX'</span>: <span class="dv">2</span>, </span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TURN_TX'</span>: <span class="dv">3</span>, </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SITTING_DOWN_TX'</span>: <span class="dv">4</span>, </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SEATED_TX'</span>: <span class="dv">5</span>, </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'STANDING_UP_TX'</span>: <span class="dv">6</span>,</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WALKING_RX'</span>: <span class="dv">7</span>,</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TURN_RX'</span>: <span class="dv">8</span>,</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SITTING_DOWN_RX'</span>: <span class="dv">9</span>,</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>LABELS <span class="op">=</span> [<span class="st">'SEATED_RX'</span>,<span class="st">'STANDING_UP_RX'</span>,<span class="st">'WALKING_TX'</span>,<span class="st">'TURNING_TX'</span>,<span class="st">'SITTING_DOWN_TX'</span>, <span class="st">'SEATED_TX'</span>, <span class="st">'STANDING_UP_TX'</span>,<span class="st">'WALKING_RX'</span>,<span class="st">'TURNING_RX'</span>,<span class="st">'SITTING_DOWN_RX'</span>]</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>NUM_CLASSES <span class="op">=</span> <span class="bu">len</span>(LABELS)</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>TRAIN_IDS <span class="op">=</span> [<span class="st">'e01_rx_tx'</span>, <span class="st">'e01_tx_rx'</span>, <span class="st">'e02_rx_tx'</span>, <span class="st">'e02_tx_rx'</span>, <span class="st">'e03_rx_tx'</span>, <span class="st">'e03_tx_rx'</span>, <span class="st">'e04_rx_tx'</span>, <span class="st">'e04_tx_rx'</span>,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>             <span class="st">'e05_rx_tx'</span>, <span class="st">'e05_tx_rx'</span>, <span class="st">'e06_rx_tx'</span>, <span class="st">'e06_tx_rx'</span>, <span class="st">'e07_rx_tx'</span>, <span class="st">'e07_tx_rx'</span>, <span class="st">'e08_rx_tx'</span>, <span class="st">'e08_tx_rx'</span>]</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>TEST_IDS <span class="op">=</span> [<span class="st">'e09_rx_tx'</span>, <span class="st">'e09_tx_rx'</span>, <span class="st">'e10_rx_tx'</span>, <span class="st">'e10_tx_rx'</span>]</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>FOLDS <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mlp_model():</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    set_seed()</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> keras.Sequential([</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">128</span>, activation<span class="op">=</span><span class="st">'relu'</span>, input_shape<span class="op">=</span>(<span class="dv">500</span>,)),</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">1024</span>, activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">1024</span>, activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">1024</span>, activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>        layers.Dense(NUM_CLASSES, activation<span class="op">=</span><span class="st">'softmax'</span>)</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">'categorical_crossentropy'</span>, optimizer<span class="op">=</span>keras.optimizers.Adam(learning_rate<span class="op">=</span><span class="fl">0.0005</span>), metrics<span class="op">=</span>[<span class="st">'accuracy'</span>])</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cnn_model():</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>    set_seed()</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> keras.Sequential([</span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>        layers.Conv2D(filters<span class="op">=</span><span class="dv">128</span>, kernel_size<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">25</span>), input_shape<span class="op">=</span>(<span class="dv">56</span>, <span class="dv">50</span>, <span class="dv">1</span>)),</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>        layers.BatchNormalization(),</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>        layers.Activation(<span class="st">'relu'</span>),</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>        layers.MaxPooling2D(),</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>        layers.Flatten(),</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">512</span>, activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>        layers.Dense(NUM_CLASSES, activation<span class="op">=</span><span class="st">'softmax'</span>)</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">'categorical_crossentropy'</span>, optimizer<span class="op">=</span>keras.optimizers.Adam(learning_rate<span class="op">=</span><span class="fl">0.0001</span>), metrics<span class="op">=</span>[<span class="st">'accuracy'</span>])</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> model_builder(model_type):</span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> model_type <span class="op">==</span> <span class="st">'cnn'</span>:</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> cnn_model</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mlp_model</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser()</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--data_dir'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'data directory'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--reports_dir'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'directory to store the generated classification reports'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--model'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'optimize hyperparameters for selected model'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, choices<span class="op">=</span>[<span class="st">'mlp'</span>, <span class="st">'cnn'</span>])</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>    d1_windows, d1_labels <span class="op">=</span> load_data(os.path.join(args.data_dir, <span class="st">'D1'</span>))</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>    d1_labels_cat <span class="op">=</span> ground_truth_to_categorical(d1_labels, MAPPING)    </span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> combine_windows(d1_windows, d1_labels_cat)</span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Starting 10-fold cross-validation"</span>)</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>    cv_reports <span class="op">=</span> cross_validation(x, y, model_builder(args.model), FOLDS, BATCH_SIZE, EPOCHS, LABELS)</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>    save_json(cv_reports, args.reports_dir, <span class="st">'cv_report.json'</span>)</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Starting D1T training and D1E evaluation"</span>)</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>    (x_d1t, y_d1t), (x_d1e, y_d1e) <span class="op">=</span> split_train_test(d1_windows, d1_labels_cat, TRAIN_IDS, TEST_IDS)</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_builder(args.model)()</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>    model.fit(x_d1t, y_d1t, batch_size<span class="op">=</span>BATCH_SIZE, epochs<span class="op">=</span>EPOCHS, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>    report <span class="op">=</span> evaluate_model(model, x_d1e, y_d1e, LABELS)</span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>    save_json(report, args.reports_dir, <span class="st">'d1_report.json'</span>)</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Starting D2, D3 and D4 evaluation"</span>)</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> eval_dataset <span class="kw">in</span> [<span class="st">'D2'</span>, <span class="st">'D3'</span>, <span class="st">'D4'</span>]:</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>        windows, labels <span class="op">=</span> load_data(os.path.join(args.data_dir, eval_dataset))</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>        labels_cat <span class="op">=</span> ground_truth_to_categorical(labels, MAPPING)    </span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> combine_windows(windows, labels_cat)</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>        report <span class="op">=</span> evaluate_model(model, x, y, LABELS)</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>        save_json(report, args.reports_dir, <span class="ss">f'</span><span class="sc">{</span>eval_dataset<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">_report.json'</span>)</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
</section>
<section id="investigating-the-causes-of-failure" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="investigating-the-causes-of-failure">Investigating the causes of failure</h2>
<p>The previous methodology resulted in non-satisfactory outcomes (see <a href="05.1_localized-har.html" class="quarto-xref"><span>Localized HAR based on Wi-Fi CSI</span></a>). The results showed a clear degradation in the classification accuracy of the employed CNN model when the evaluation took into account data collected spaced in time regarding the training data. That is, classification accuracy quickly degrades over time.</p>
<p>Notwithstanding, temporal instability of CSI data is only one possible explanation for the poor obtained results. Concretely, the following factors could affect the results:</p>
<ol type="1">
<li>The selected methods (i.e., data preprocessing and model architecture) might not be able to properly work with CSI data, i.e., generalize from the training data. While CNN approaches have proven to provide good results working with CSI data <span class="citation" data-cites="ma2019wifi">(<a href="references.html#ref-ma2019wifi" role="doc-biblioref">Ma, Zhou, and Wang 2019</a>)</span>, most related works using the ESP32 microcontroller employ other architectures, such as the MLP.</li>
<li>The employed hardware for CSI extraction, ESP32-S2 microcontroller, might not be appropriate for such a task. Other devices, such as the Intel 5300 or Atheros NICs might be more appropriate.</li>
<li>The collected dataset might have been affected by some external interference, altering the environment and changing the CSI data.</li>
<li>The CSI data is not stable over time and therefore can not be used for real-life applications.</li>
</ol>
<p>Next, we aim to determine the cause of the bad results presented in <a href="05.1_localized-har.html" class="quarto-xref"><span>Localized HAR based on Wi-Fi CSI</span></a>. First, to determine that our method is appropriate for CSI data (1), we applied it to two public datasets and compared the results with other state-of-the-art works (<a href="05.2_methods-validation.html" class="quarto-xref"><span>Validation of employed methods</span></a>). Then, to prove that alternative methods validated in the literature would have obtained similar results to our method (1), we applied the method from a related work on our collected dataset (<a href="05.2_methods-validation.html" class="quarto-xref"><span>Validation of employed methods</span></a>). Finally, to verify the temporal stability of the CSI data (4), a new dataset was collected over several days to evaluate the similarity of the data across days (<a href="05.3_csi-stability.html" class="quarto-xref"><span>Temporal stability of Wi-Fi CSI data from ESP32 microcontrollers</span></a>). The remaining factors could not be explored due to resource limitations (2) and the impossibility of determining the existence of external interferences while collecting the dataset (3).</p>
<section id="validation-of-method-on-public-datasets" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="validation-of-method-on-public-datasets">Validation of method on public datasets</h3>
<section id="methodology" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="methodology">Methodology</h4>
<p>Two publicly available datasets have been used to validate the methods and model employed: the <strong>StanWiFi</strong> and the <strong>Multi-environment</strong> dataset.</p>
<ul>
<li><strong>StanWiFi</strong>: it was collected by <span class="citation" data-cites="yousefi2017survey">(<a href="references.html#ref-yousefi2017survey" role="doc-biblioref">Yousefi et al. 2017</a>)</span> and made available in GitHub<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. The dataset was collected with a Wi-Fi router (Tx) and an Intel 5300 NIC with three Rx antennas, both separated by <span class="math inline">\(3\)</span> meter in a LOS environment. The dataset contains CSI data from <span class="math inline">\(90\)</span> subcarriers sampled at <span class="math inline">\(1000\)</span>Hz corresponding to <span class="math inline">\(7\)</span> activities: <em>lie</em>, <em>fall</em>, <em>walk</em>, <em>run</em>, <em>sit down</em>, <em>stand up</em> and <em>pick up</em>. For comparison purposes, the <em>pick up</em> activity was removed from the dataset since other works do so.</li>
<li><strong>Multi-environment</strong>: collected in three different environments, <code>E1</code> and <code>E2</code> in LOS conditions and <code>E3</code> in NLOS condition <span class="citation" data-cites="alsaify2020dataset">(<a href="references.html#ref-alsaify2020dataset" role="doc-biblioref">Alsaify et al. 2020</a>)</span>. The latter dataset is discarded since we focus on LOS conditions. The datasets were collected using two computers (Tx and Rx) equipped with an Intel 5300 NIC, which were separated by <span class="math inline">\(3.7\)</span> meter sin <code>E1</code> and <span class="math inline">\(7.6\)</span> meters in <code>E2</code>. The CSI data was collected from <span class="math inline">\(90\)</span> subcarriers at <span class="math inline">\(320\)</span>Hz corresponding to <span class="math inline">\(12\)</span> different activities classified in <span class="math inline">\(6\)</span> groups: <em>no movement</em>, <em>falling</em>, <em>walking</em>, <em>sitting/standing</em>, <em>turning</em> and <em>pick up</em>.</li>
</ul>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;<a href="https://github.com/ermongroup/Wifi_Activity_Recognition">Wifi_Activity_Recognition</a></p></div></div><p>The <strong>data preparation</strong> steps described in <a href="#sec-csi_data_prep" class="quarto-xref"><span>Data preparation</span></a> were applied to both datasets. While for the collected dataset the windows consisted of <span class="math inline">\(0.5\)</span> seconds of data, a window size of <span class="math inline">\(1\)</span> seconds was employed in both public datasets since they contain a higher amount of data.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The script employed to execute the process in StanWiFi dataset is <code>01_2_stanwifi-processing.py</code>.</p>
<div data-add-from="libs/chapter5/pipeline/01_2_stanwifi-processing.py" data-code-fold="true" data-code-filename="01_2_stanwifi-processing.py">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Data preprocessing script for StanWiFi dataset.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">Processes the raw data by processing the windows generated by the author's scripts using DBSCAN for outlier detection</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">and 2-level DWT for threshold based filtering.</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">**Example**:</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">    $ python 01_2_stanwifi-processing.py </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">        --input_data_path &lt;PATH_OF_RAW_DATA&gt; </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">        --windowed_data_path &lt;PATH_TO_STORE_RESULTS&gt;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">"../../.."</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cross_vali_input_data <span class="im">import</span> csv_import</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.processing <span class="im">import</span> proposed_method</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser()</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--windowed_data_path'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Path to store windowed data'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    x_bed, x_fall, x_pickup, x_run, x_sitdown, x_standup, x_walk, <span class="op">\</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    y_bed, y_fall, y_pickup, y_run, y_sitdown, y_standup, y_walk <span class="op">=</span> csv_import()</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    x_subsets <span class="op">=</span> [x_bed, x_fall, x_run, x_sitdown, x_standup, x_walk]</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    y_subsets <span class="op">=</span> [y_bed, y_fall, y_run, y_sitdown, y_standup, y_walk]</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    x_proc <span class="op">=</span> []</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    y_proc <span class="op">=</span> []</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(x_subsets, y_subsets):</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        x_proc.append(proposed_method(x))</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>        y_proc.append(np.delete(y, [<span class="dv">0</span>,<span class="dv">4</span>], axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.vstack(x_proc)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.transpose(x, axes<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.vstack(y_proc)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    np.save(os.path.join(args.windowed_data_path, <span class="st">'x.npy'</span>), x)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    np.save(os.path.join(args.windowed_data_path, <span class="st">'y.npy'</span>), y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The script employed to execute the process in Multi-environment dataset is <code>01_3_multienvironment-processing.py</code>.</p>
<div data-add-from="libs/chapter5/pipeline/01_3_multienvironment-processing.py" data-code-fold="true" data-code-filename="01_3_multienvironment-processing.py">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Data preprocessing script for Multi-environment dataset.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">Processes the raw data by aranging samples in windows and processing them using DBSCAN for outlier detection</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">and 2-level DWT for threshold based filtering</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">**Example**:</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    $ python 01_3_multienvironment-processing.py </span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">        --input_data_path &lt;PATH_OF_RAW_DATA&gt; </span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">        --windowed_data_path &lt;PATH_TO_STORE_RESULTS&gt;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> copy</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">"../../.."</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> alive_progress <span class="im">import</span> alive_bar</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.processing <span class="im">import</span> proposed_method</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> sqrt</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>ACTIVITY_MAPPING <span class="op">=</span> {</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A01'</span>: <span class="st">'A1'</span>,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A02'</span>: <span class="st">'A2'</span>,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A03'</span>: <span class="st">'A1'</span>,</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A04'</span>: <span class="st">'A1'</span>,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A05'</span>: <span class="st">'A2'</span>,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A06'</span>: <span class="st">'A3'</span>,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A07'</span>: <span class="st">'A5'</span>,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A08'</span>: <span class="st">'A3'</span>,</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A09'</span>: <span class="st">'A5'</span>,</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A10'</span>: <span class="st">'A4'</span>,</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A11'</span>: <span class="st">'A4'</span>,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'A12'</span>: <span class="st">'A6'</span>,</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_multienvironment_dataset(environment):</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {}</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    subject_dirs <span class="op">=</span> os.listdir(environment)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    subject_dirs <span class="op">=</span> <span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> x: x.startswith(<span class="st">'Subject'</span>), subject_dirs))</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> alive_bar(<span class="bu">len</span>(subject_dirs), title<span class="op">=</span><span class="ss">f'Loading data from subjects'</span>, force_tty<span class="op">=</span><span class="va">True</span>) <span class="im">as</span> progress_bar:</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> subject_dir <span class="kw">in</span> subject_dirs:</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>            subject <span class="op">=</span> <span class="ss">f'S</span><span class="sc">{</span><span class="bu">int</span>(subject_dir.split(<span class="st">" "</span>)[<span class="op">-</span><span class="dv">1</span>])<span class="sc">:02d}</span><span class="ss">'</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>            data[subject] <span class="op">=</span> {}</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>            subject_dir_path <span class="op">=</span> os.path.join(environment, subject_dir)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> os.listdir(subject_dir_path):</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> <span class="bu">file</span>.endswith(<span class="st">'.csv'</span>):</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">continue</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>                base_activity <span class="op">=</span> <span class="bu">file</span>.split(<span class="st">'_'</span>)[<span class="dv">3</span>]</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>                file_path <span class="op">=</span> os.path.join(subject_dir_path, <span class="bu">file</span>)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>                df <span class="op">=</span> pd.read_csv(file_path)</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>                df <span class="op">=</span> df.iloc[<span class="dv">160</span>:<span class="op">-</span><span class="dv">160</span>] <span class="co">#remove 0.5 sec after and before due to noise</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> base_activity <span class="kw">not</span> <span class="kw">in</span> data[subject]:</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>                    data[subject][base_activity] <span class="op">=</span> df</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>                    data[subject][base_activity] <span class="op">=</span> pd.concat([data[subject][base_activity], df])</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>            progress_bar()</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> amplitude_from_raw_data(data):</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>    amplitudes <span class="op">=</span> {}</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> alive_bar(<span class="bu">len</span>(data.keys()), title<span class="op">=</span><span class="ss">f'Extracting amplitudes from subject</span><span class="ch">\'</span><span class="ss">s data'</span>, force_tty<span class="op">=</span><span class="va">True</span>) <span class="im">as</span> progress_bar:</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> subject <span class="kw">in</span> data:</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>            amplitudes[subject] <span class="op">=</span> {}</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> activity <span class="kw">in</span> data[subject]:</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>                activity_data <span class="op">=</span> data[subject][activity]</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>                activity_amplitudes <span class="op">=</span> []</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> index, row <span class="kw">in</span> activity_data.iterrows():</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>                    instance_amplitudes <span class="op">=</span> []</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> antenna <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">4</span>):</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">for</span> subcarrier <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">31</span>):</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>                            csi_data <span class="op">=</span> row[<span class="ss">f'csi_1_</span><span class="sc">{</span>antenna<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>subcarrier<span class="sc">}</span><span class="ss">'</span>]</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>                            real, imaginary <span class="op">=</span> csi_data.split(<span class="st">'+'</span>)</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>                            real <span class="op">=</span> <span class="bu">int</span>(real)</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>                            imaginary <span class="op">=</span> <span class="bu">int</span>(imaginary[:<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>                            instance_amplitudes.append(sqrt(imaginary <span class="op">**</span> <span class="dv">2</span> <span class="op">+</span> real <span class="op">**</span> <span class="dv">2</span>))</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>                    activity_amplitudes.append(instance_amplitudes)</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>                amplitudes[subject][activity] <span class="op">=</span> np.array(activity_amplitudes)</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>            progress_bar()</span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> amplitudes</span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_windows(amplitudes, window_size<span class="op">=</span><span class="dv">320</span>, window_overlap<span class="op">=</span><span class="dv">160</span>):</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>    windows <span class="op">=</span> {}</span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>    windows_labels <span class="op">=</span> {}</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> subject_id <span class="kw">in</span> amplitudes:</span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>        subject_windows <span class="op">=</span> []</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>        subject_windows_labels <span class="op">=</span> []</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> activity_id <span class="kw">in</span> amplitudes[subject_id]:</span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>            activity_amplitudes <span class="op">=</span> amplitudes[subject_id][activity_id].T</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>            n <span class="op">=</span> activity_amplitudes.shape[<span class="dv">1</span>] <span class="op">//</span> window_overlap</span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, (n<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span> window_overlap, window_overlap):</span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i<span class="op">+</span>window_size <span class="op">&gt;</span> activity_amplitudes.shape[<span class="dv">1</span>]:</span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>                subject_windows.append(activity_amplitudes[:,i:i<span class="op">+</span>window_size])</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>                subject_windows_labels.append(ACTIVITY_MAPPING[activity_id])</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>        windows[subject_id] <span class="op">=</span> np.array(subject_windows)</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>        windows_labels[subject_id] <span class="op">=</span> np.array(subject_windows_labels)</span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> windows, windows_labels</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_windows(windows):</span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>    proc_windows <span class="op">=</span> {}</span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> alive_bar(<span class="bu">len</span>(windows.keys()), title<span class="op">=</span><span class="ss">f'Processing subject</span><span class="ch">\'</span><span class="ss">s windows'</span>, force_tty<span class="op">=</span><span class="va">True</span>) <span class="im">as</span> progress_bar:</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> subject_id <span class="kw">in</span> windows:</span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>            windows_copy <span class="op">=</span> copy.deepcopy(windows[subject_id])</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(windows_copy)):</span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>                windows_copy[i] <span class="op">=</span> proposed_method(windows_copy[i])</span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>            proc_windows[subject_id] <span class="op">=</span> windows_copy</span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>            progress_bar()</span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> proc_windows</span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_windowed_data(data, labels, directory):</span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> subject_id, subject_data <span class="kw">in</span> data.items():</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>        np.save(os.path.join(directory, <span class="ss">f'</span><span class="sc">{</span>subject_id<span class="sc">}</span><span class="ss">_x.npy'</span>), subject_data)</span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>        np.save(os.path.join(directory, <span class="ss">f'</span><span class="sc">{</span>subject_id<span class="sc">}</span><span class="ss">_x.npy'</span>), labels[subject_id])</span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser()</span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--input_data_path'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Path of input data'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--windowed_data_path'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Path to store windowed data'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> dataset <span class="kw">in</span> [<span class="st">'ENVIRONMENT 1'</span>, <span class="st">'ENVIRONMENT 2'</span>]:</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Processing dataset </span><span class="sc">{</span>dataset<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> load_multienvironment_dataset(os.path.join(args.input_data_path, dataset))</span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>        amplitudes <span class="op">=</span> amplitude_from_raw_data(data)</span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a>        windows, windows_labels <span class="op">=</span> create_windows(amplitudes)</span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> data, amplitudes</span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>        proc_windows <span class="op">=</span> process_windows(windows)</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>        save_windowed_data(proc_windows, windows_labels, args.windowed_data_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<p>As regards the <strong>HAR classifier</strong>, the model architecture described in <a href="#sec-csi_model" class="quarto-xref"><span>HAR classifier</span></a> was employed, with minor adaptations in some hyperparameters due to computational limitations<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. The adaptations in each dataset are the following:</p>
<div class="no-row-height column-margin column-container"><div id="fn2"><p><sup>2</sup>&nbsp;The higher dimensionality of both datasets (higher sampling rate and data from more subcarriers) compared with the collected one makes it unfeasible to use the previous model due to memory limitations.</p></div></div><ul>
<li>StanWiFi: <span class="math inline">\(16\)</span> <strong>number of filters</strong>, <span class="math inline">\(128\)</span> <strong>batch size</strong> and <span class="math inline">\(30\)</span> <strong>epochs</strong>.</li>
<li>Multi-environment (<code>E1</code> and <code>E2</code>): <span class="math inline">\(8\)</span> <strong>number of filters</strong>, <span class="math inline">\(256\)</span> <strong>batch size</strong> and <span class="math inline">\(30\)</span> <strong>epochs</strong>.</li>
</ul>
<p>Finally, the <strong>experimental procedure</strong> consisted of the <span class="math inline">\(10\)</span>-fold cross-validation to evaluate the CNN model in the public datasets. The results are compared with other related works also employing a <em>K</em>-fold cross-validation approach.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The script employed to execute this process in the StanWiFi is <code>03_2_cross-validation.py</code> with the flag <code>--dataset stanwifi</code>. The same script was used for the Multienvironment dataset employing the flag <code>--dataset multienvironment</code>.</p>
<div data-add-from="libs/chapter5/pipeline/03_2_cross-validation.py" data-code-fold="true" data-code-filename="03_2_cross-validation.py">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Cross-validation script</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">Performs a cross-validation on the selected dataset.</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">**Example**:</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">    $ python 03_2_cross-validation.py </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="co">        --data_dir &lt;PATH_OF_DATA&gt; </span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">        --reports_dir &lt;PATH_TO_STORE_REPORTS&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">        --dataset &lt;stanwifi,multienvironment&gt;</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">"../../.."</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.data_grouping <span class="im">import</span> combine_windows</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.ml <span class="im">import</span> cross_validation</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.common.data_loading <span class="im">import</span> ground_truth_to_categorical</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.common.utils <span class="im">import</span> save_json, set_seed</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>STANWIFI_LABELS <span class="op">=</span> [<span class="st">'LIE DOWN'</span>, <span class="st">'FALL'</span>, <span class="st">'WALK'</span>, <span class="st">'RUN'</span>, <span class="st">'SITDOWN'</span>, <span class="st">'STANDUP'</span>]</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>STANWIFI_BATCH_SIZE <span class="op">=</span> <span class="dv">128</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>MULTI_ENV_LABELS <span class="op">=</span> [<span class="st">'No movement'</span>, <span class="st">'Falling'</span>, <span class="st">'Walking'</span>, <span class="st">'Sitting/Standing'</span>, <span class="st">'Turning'</span>, <span class="st">'Pick up pen'</span>]</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>MULTI_ENV_MAPPING <span class="op">=</span> {<span class="st">'A1'</span>: <span class="dv">0</span>, <span class="st">'A2'</span>: <span class="dv">1</span>, <span class="st">'A3'</span>: <span class="dv">2</span>, <span class="st">'A4'</span>: <span class="dv">3</span>, <span class="st">'A5'</span>: <span class="dv">4</span>, <span class="st">'A6'</span>: <span class="dv">5</span>}</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>MULTIENV_BATCH_SIZE <span class="op">=</span> <span class="dv">256</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>FOLDS <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> stanwifi_model():</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    set_seed()</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> keras.Sequential([</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        layers.Conv2D(filters<span class="op">=</span><span class="dv">16</span>, kernel_size<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">25</span>), input_shape<span class="op">=</span>(<span class="dv">90</span>, <span class="dv">500</span>, <span class="dv">1</span>)),</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>        layers.BatchNormalization(),</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>        layers.Activation(<span class="st">'relu'</span>),</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>        layers.MaxPooling2D(),</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>        layers.Flatten(),</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">512</span>, activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">6</span>, activation<span class="op">=</span><span class="st">'softmax'</span>)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">'categorical_crossentropy'</span>, optimizer<span class="op">=</span>keras.optimizers.Adam(learning_rate<span class="op">=</span><span class="fl">0.0001</span>), metrics<span class="op">=</span>[<span class="st">'accuracy'</span>])</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> multienvironment_model():</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    set_seed()</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> keras.Sequential([</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>        layers.Conv2D(filters<span class="op">=</span><span class="dv">8</span>, kernel_size<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">25</span>), input_shape<span class="op">=</span>(<span class="dv">90</span>, <span class="dv">320</span>, <span class="dv">1</span>)),</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>        layers.BatchNormalization(),</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>        layers.Activation(<span class="st">'relu'</span>),</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>        layers.MaxPooling2D(),</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>        layers.Flatten(),</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">512</span>, activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">6</span>, activation<span class="op">=</span><span class="st">'softmax'</span>)</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">'categorical_crossentropy'</span>, optimizer<span class="op">=</span>keras.optimizers.Adam(learning_rate<span class="op">=</span><span class="fl">0.0001</span>), metrics<span class="op">=</span>[<span class="st">'accuracy'</span>])</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_multienv_data(path, dataset_dir):</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>    dataset_path <span class="op">=</span> os.path.join(path, dataset_dir)</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>    subjects <span class="op">=</span> [<span class="st">'S01'</span>, <span class="st">'S02'</span>, <span class="st">'S03'</span>, <span class="st">'S04'</span>, <span class="st">'S05'</span>, <span class="st">'S06'</span>, <span class="st">'S07'</span>, <span class="st">'S08'</span>, <span class="st">'S09'</span>, <span class="st">'S10'</span>] <span class="cf">if</span> dataset_dir <span class="op">==</span> <span class="st">'E1'</span> <span class="cf">else</span> [<span class="st">'S11'</span>, <span class="st">'S12'</span>, <span class="st">'S13'</span>, <span class="st">'S14'</span>, <span class="st">'S15'</span>, <span class="st">'S16'</span>, <span class="st">'S17'</span>, <span class="st">'S18'</span>, <span class="st">'S19'</span>, <span class="st">'S20'</span>] </span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>    windows <span class="op">=</span> {}</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>    windows_labels <span class="op">=</span> {}</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> subject_id <span class="kw">in</span> subjects:</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>        windows[subject_id] <span class="op">=</span> np.load(os.path.join(dataset_path, <span class="ss">f'x_</span><span class="sc">{</span>subject_id<span class="sc">}</span><span class="ss">.npy'</span>))</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>        windows_labels[subject_id] <span class="op">=</span> np.load(os.path.join(dataset_path, <span class="ss">f'y_</span><span class="sc">{</span>subject_id<span class="sc">}</span><span class="ss">.npy'</span>))</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> windows, windows_labels</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser()</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--data_dir'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'data directory'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--reports_dir'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'directory to store the generated classification reports'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--dataset'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'optimize hyperparameters for selected model'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, choices<span class="op">=</span>[<span class="st">'stanwifi'</span>, <span class="st">'multienvironment'</span>])</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> args.dataset <span class="op">==</span> <span class="st">'stanwifi'</span>:</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> np.load(os.path.join(args.data_dir, <span class="st">'x.npy'</span>))</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> np.load(os.path.join(args.data_dir, <span class="st">'x.npy'</span>))</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>        model_builder <span class="op">=</span> stanwifi_model</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>        batch_size <span class="op">=</span> STANWIFI_BATCH_SIZE</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> STANWIFI_LABELS</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>        reports <span class="op">=</span> cross_validation(x, y, stanwifi_model, FOLDS, STANWIFI_BATCH_SIZE, EPOCHS, STANWIFI_LABELS)</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>        save_json(reports, args.reports_dir, <span class="st">'cv_report.json'</span>)</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> dataset <span class="kw">in</span> [<span class="st">'E1'</span>, <span class="st">'E2'</span>]:</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>            windows, windows_labels <span class="op">=</span> load_multienv_data(args.data_dir, dataset)</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>            windows_labels_cat <span class="op">=</span> ground_truth_to_categorical(windows_labels, MULTI_ENV_MAPPING)  </span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>            x, y <span class="op">=</span> combine_windows(windows, windows_labels_cat)</span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>            reports <span class="op">=</span> cross_validation(x, y, multienvironment_model, FOLDS, MULTIENV_BATCH_SIZE, EPOCHS, MULTI_ENV_LABELS)</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>            save_json(reports, args.reports_dir, <span class="ss">f'</span><span class="sc">{</span>dataset<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">-cv_report.json'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
</section>
<section id="validation-of-alternative-method-in-the-collected-dataset" class="level3">
<h3 class="anchored" data-anchor-id="validation-of-alternative-method-in-the-collected-dataset">Validation of alternative method in the collected dataset</h3>
<p>The methods proposed by <span class="citation" data-cites="choi2022wi">Choi et al. (<a href="references.html#ref-choi2022wi" role="doc-biblioref">2022</a>)</span> have been applied to the collected dataset. In their work, the authors extract a set of hand-crafted features from the CSI data and employ an MLP model for crowd counting and localization. Choi’s et al.&nbsp;methods have been selected since they followed an appropiate evaluation taking into account the stability of the signal and only showed a small drop in performance.</p>
<section id="methodology-1" class="level4">
<h4 class="anchored" data-anchor-id="methodology-1">Methodology</h4>
<p>As in <a href="#sec-csi_data_prep" class="quarto-xref"><span>Data preparation</span></a>, the amplitude is extracted from the CSI data and the dataset is arranged in windows of <span class="math inline">\(50\)</span> samples with a <span class="math inline">\(50\%\)</span> overlap. Then, the methods presented by <span class="citation" data-cites="choi2022wi">Choi et al. (<a href="references.html#ref-choi2022wi" role="doc-biblioref">2022</a>)</span> are applied:</p>
<ul>
<li><strong>Noise removal</strong>: the Hampel and the Savitzky-Golay filters are applied on each subcarrier.</li>
<li><strong>Feature extraction</strong>: the extracted features to be used as input of the MLP model are the <strong>Mean</strong>, <strong>SD</strong>, <strong>Maximum</strong>, <strong>Minimum</strong>, <strong>Lower quartile</strong>, <strong>Higher quartile</strong>, <strong>IQR</strong>, <strong>Differences between adjacent</strong> subcarriers and the <strong>Euclidean distance</strong>.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The script employed to execute this process is <code>01_1_preliminar-dataset-processing.py</code> with the flag <code>--method choi</code>.</p>
<div data-add-from="libs/chapter5/pipeline/01_1_preliminar-dataset-processing.py" data-code-fold="true" data-code-filename="01_1_preliminar-dataset-processing.py">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Data preprocessing script for preliminar dataset.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">Processes the raw data by: arange samples in windows and process them using 1) DBSCAN for outlier detection</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">and 2-level DWT for threshold based filtering or 2) Choi et al. method.</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">**Example**:</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">    $ python 01_1_preliminar-dataset-processing.py </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">        --input_data_path &lt;PATH_OF_RAW_DATA&gt; </span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">        --windowed_data_path &lt;PATH_TO_STORE_RESULTS&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">        --method &lt;PROCESSING_METHOD&gt;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">        --window_size &lt;WINDOW_SIZE&gt;</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">        --window_overlap &lt;WINDOW_OVERLAP&gt;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">"../../.."</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> alive_progress <span class="im">import</span> alive_bar</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.processing <span class="im">import</span> proposed_method, choi_method</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.raw_data_loading <span class="im">import</span> load_labelled_data</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>WINDOW_SIZE <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>WINDOW_OVERLAP <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_windows(executions_amplitudes, executions_labels, window_size, window_overlap):</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    win <span class="op">=</span> {}</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    win_labels <span class="op">=</span> {}</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> execution_id <span class="kw">in</span> executions_amplitudes:</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        amplitudes <span class="op">=</span> executions_amplitudes[execution_id]</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        exec_labels <span class="op">=</span> executions_labels[execution_id]</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> amplitudes</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> data.shape[<span class="dv">1</span>] <span class="op">//</span> window_overlap</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        windows <span class="op">=</span> []</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        windows_labels <span class="op">=</span> []</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, (n<span class="op">-</span><span class="dv">1</span>) <span class="op">*</span> window_overlap, window_overlap):</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i<span class="op">+</span>window_size <span class="op">&gt;</span> data.shape[<span class="dv">1</span>]:</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>            window_labels <span class="op">=</span> exec_labels[i:i<span class="op">+</span>window_size]</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>            values, counts <span class="op">=</span> np.unique(window_labels, return_counts<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(values) <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>            windows.append(data[:,i:i<span class="op">+</span>window_size])</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>            windows_labels.append(values[counts.argmax()])</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>        windows <span class="op">=</span> np.array(windows)</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>        windows_labels <span class="op">=</span> np.array(windows_labels)</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>        win[execution_id] <span class="op">=</span> windows</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>        win_labels[execution_id] <span class="op">=</span> windows_labels</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> win, win_labels</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_windows(executions_windows, processing_function):</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    processed_windows <span class="op">=</span> {}</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>    executions_ids <span class="op">=</span> executions_windows.keys()</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> alive_bar(<span class="bu">len</span>(executions_ids), title<span class="op">=</span><span class="ss">f'Processing windows'</span>, force_tty<span class="op">=</span><span class="va">True</span>) <span class="im">as</span> progress_bar:</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> execution_id <span class="kw">in</span> executions_ids:</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>            proc_windows <span class="op">=</span> []</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>            windows <span class="op">=</span> executions_windows[execution_id]</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> window <span class="kw">in</span> windows:</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>                proc_windows.append(processing_function(window))</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>            processed_windows[execution_id] <span class="op">=</span> np.array(proc_windows)</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>            progress_bar()</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> processed_windows</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_windowed_data(data, labels, directory):</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(directory):</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>        os.makedirs(directory)</span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>    x_file_path <span class="op">=</span> os.path.join(directory, <span class="st">'</span><span class="sc">{0}</span><span class="st">-x.npy'</span>)</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>    y_file_path <span class="op">=</span> os.path.join(directory, <span class="st">'</span><span class="sc">{0}</span><span class="st">-y.npy'</span>)</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> execution_id <span class="kw">in</span> data:</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> data[execution_id]</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> labels[execution_id]</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>        np.save(x_file_path.<span class="bu">format</span>(execution_id), x)</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>        np.save(y_file_path.<span class="bu">format</span>(execution_id), y)</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser()</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--input_data_path'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Path of input data'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--windowed_data_path'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Path to store windowed data'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--method'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Processing method'</span>, required<span class="op">=</span><span class="va">True</span>, choices<span class="op">=</span>[<span class="st">'proposed'</span>, <span class="st">'choi'</span>])</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>    processing_function <span class="op">=</span> proposed_method <span class="cf">if</span> args.method <span class="op">==</span> <span class="st">'proposed'</span> <span class="cf">else</span> choi_method</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> dataset <span class="kw">in</span> [<span class="st">'D1'</span>, <span class="st">'D2'</span>, <span class="st">'D3'</span>, <span class="st">'D4'</span>]:</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Processing dataset </span><span class="sc">{</span>dataset<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>        executions_amp, labels <span class="op">=</span> load_labelled_data(os.path.join(args.input_data_path, dataset))</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>        windows, windows_labels <span class="op">=</span> create_windows(executions_amp, labels, WINDOW_SIZE, WINDOW_OVERLAP)</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>        windows_processed <span class="op">=</span> process_windows(windows, processing_function)</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>        save_windowed_data(windows_processed, windows_labels, os.path.join(args.windowed_data_path, dataset))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<p>As <strong>HAR classifier</strong>, an MLP model is employed, but instead of using the same architecture as the one employed by Choi, a <strong>Grid search</strong> process was executed to determine the most appropriate hyperparameters for our dataset.</p>
<p>The <strong>Grid search</strong> was carried out as described in <a href="#sec-csi_model" class="quarto-xref"><span>HAR classifier</span></a>. <a href="#tbl-csi_hyperparameters_mlp" class="quarto-xref">Table&nbsp;<span>3</span></a> contains the best combination of hyperparameters.</p>
<div class="quarto-embed-nb-cell" data-notebook="/Users/miguel/Documents/Projects/thesis/05.1.2_grid-search.ipynb" data-notebook-title="Grid Search results" data-notebook-cellid="cell-tbl-csi_hyperparameters_mlp">
<div class="cell" data-execution_count="6">
<div id="tbl-csi_hyperparameters_mlp" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="6">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-csi_hyperparameters_mlp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Best combination of hyperparameters.
</figcaption>
<div aria-describedby="tbl-csi_hyperparameters_mlp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">input_layer</td>
<td>128.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">n_hidden</td>
<td>3.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">hidden_layer</td>
<td>1024.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">lr</td>
<td>0.0005</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The script employed to execute the Grid Search is <code>02_hyperparameter-optimization.py</code> with the flag <code>--model mlp</code>.</p>
<div data-add-from="libs/chapter5/pipeline/02_hyperparameter-optimization.py" data-code-fold="true" data-code-filename="02_hyperparameter-optimization.py">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Hyperparameters Grid Search script.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">Performs an hyperparameter Grid Search on the specified model. The selected hyperparameters for the search</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">can be found in `tuning_configuration.py`.</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">**Example**:</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">    $ python 02_hyperparameter-optimization.py </span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">        --data_dir &lt;PATH_OF_DATA&gt; </span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">        --model &lt;MLP,CNN&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">        --phase &lt;initial,extra-layers&gt;</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">        --batch_size &lt;BATCH_SIZE&gt;</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">        --epochs &lt;EPOCHS&gt;</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">        --executions &lt;EXECUTIONS&gt;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">"../../.."</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.data_loading <span class="im">import</span> load_data</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.data_grouping <span class="im">import</span> combine_windows</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.hyperparameters_tuning <span class="im">import</span> get_model_builder, create_tuner, tune, get_tuning_summary</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.tuning_configuration <span class="im">import</span> get_tuning_configuration</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.common.data_loading <span class="im">import</span> ground_truth_to_categorical</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.common.utils <span class="im">import</span> save_json, set_seed</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>TUNING_DIR <span class="op">=</span> <span class="st">'GRID_SEARCH_</span><span class="sc">{0}</span><span class="st">'</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>TUNING_SUMMARY_FILE <span class="op">=</span> <span class="st">'summary.json'</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>N_EXECUTIONS <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>MAPPING <span class="op">=</span> {</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SEATED_RX'</span>: <span class="dv">0</span>, </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">'STANDING_UP_RX'</span>: <span class="dv">1</span>, </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WALKING_TX'</span>: <span class="dv">2</span>, </span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TURN_TX'</span>: <span class="dv">3</span>, </span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SITTING_DOWN_TX'</span>: <span class="dv">4</span>, </span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SEATED_TX'</span>: <span class="dv">5</span>, </span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">'STANDING_UP_TX'</span>: <span class="dv">6</span>,</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WALKING_RX'</span>: <span class="dv">7</span>,</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TURN_RX'</span>: <span class="dv">8</span>,</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SITTING_DOWN_RX'</span>: <span class="dv">9</span>,</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tune_model(data, model_type, batch_size, epochs, n_executions, phase):</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>    set_seed()    </span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>    model_builder <span class="op">=</span> get_model_builder(model_type)</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    optimizing_layers <span class="op">=</span> phase <span class="op">==</span> <span class="st">'extra-layers'</span> </span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> source, (x, y) <span class="kw">in</span> data.items():</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>        features_dimension <span class="op">=</span> x.shape[<span class="dv">1</span>]</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>        tuning_configuration <span class="op">=</span> get_tuning_configuration(model_type, source <span class="cf">if</span> optimizing_layers <span class="cf">else</span> <span class="va">None</span>)</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>        tuning_configuration[<span class="st">'features_dimension'</span>] <span class="op">=</span> features_dimension</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>        tuning_project <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>model_type<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>source<span class="sc">}{</span><span class="st">"_layers"</span> <span class="cf">if</span> optimizing_layers <span class="cf">else</span> <span class="st">""</span><span class="sc">}</span><span class="ss">'</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Tuning </span><span class="sc">{</span>model_type<span class="sc">}</span><span class="ss"> model with </span><span class="sc">{</span>source<span class="sc">}</span><span class="ss"> data'</span>)</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>        tuner <span class="op">=</span> create_tuner(</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>            model_builder, </span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>            n_executions, </span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>            tuning_configuration, </span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>            TUNING_DIR.<span class="bu">format</span>(phase), </span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>            tuning_project</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>        tuner <span class="op">=</span> tune(tuner, x, y, epochs, batch_size)</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>        save_tuning_summary(tuner, os.path.join(TUNING_DIR, tuning_project))</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_tuning_summary(tuner, tuning_dir):</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    save_json(get_tuning_summary(tuner), tuning_dir, TUNING_SUMMARY_FILE)</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser()</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--data_dir'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'data directory'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--model'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'optimize hyperparameters for selected model'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, choices<span class="op">=</span>[<span class="st">'mlp'</span>, <span class="st">'cnn'</span>])</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--phase'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'tuning phase: &lt;initial&gt; to tune layer hyperparameters and &lt;extra-layers&gt; to tune number of layers'</span> , <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, choices<span class="op">=</span>[<span class="st">'initial'</span>, <span class="st">'extra-layers'</span>])</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--batch_size'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'training batch size'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span>BATCH_SIZE)</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--epochs'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'training epochs'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span>EPOCHS)</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--executions'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'executions per trial'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">int</span>, default<span class="op">=</span>N_EXECUTIONS)</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>    d1_windows, d1_labels <span class="op">=</span> load_data(args.data_dir)</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> ground_truth_to_categorical(d1_labels, MAPPING)    </span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> combine_windows(d1_windows, y)</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(x.shape)</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> {</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">'csi'</span>: (x, y)</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>    tune_model(data, args.model, args.batch_size, args.epochs, args.executions, args.phase)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<p>The same <strong>experimental procedure</strong> described in <a href="#sec-csi_exp_procedure" class="quarto-xref"><span>Experimental procedure</span></a> with the three evaluation approaches is employed using the method presented by Choi in our collected dataset.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The script employed to execute this process is <code>03_1_multiple-evaluations.py</code> with the flag <code>--model mlp</code>.</p>
<div data-add-from="libs/chapter5/pipeline/03_1_multiple-evaluations.py" data-code-fold="true" data-code-filename="03_1_multiple-evaluations.py">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Multiple evaluation script</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">Performs a cross-validation and an evaluation with different subsets collected at different time frames.</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">**Example**:</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">    $ python 03_1_multiple_evaluations.py </span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">        --data_dir &lt;PATH_OF_DATA&gt; </span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">        --reports_dir &lt;PATH_TO_STORE_REPORTS&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">        --model &lt;MLP,CNN&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">"../../.."</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.data_loading <span class="im">import</span> load_data</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.data_grouping <span class="im">import</span> combine_windows, split_train_test</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.ml <span class="im">import</span> cross_validation, evaluate_model</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.common.data_loading <span class="im">import</span> ground_truth_to_categorical</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.common.utils <span class="im">import</span> save_json, set_seed</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>MAPPING <span class="op">=</span> {</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SEATED_RX'</span>: <span class="dv">0</span>, </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'STANDING_UP_RX'</span>: <span class="dv">1</span>, </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WALKING_TX'</span>: <span class="dv">2</span>, </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TURN_TX'</span>: <span class="dv">3</span>, </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SITTING_DOWN_TX'</span>: <span class="dv">4</span>, </span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SEATED_TX'</span>: <span class="dv">5</span>, </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'STANDING_UP_TX'</span>: <span class="dv">6</span>,</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'WALKING_RX'</span>: <span class="dv">7</span>,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TURN_RX'</span>: <span class="dv">8</span>,</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SITTING_DOWN_RX'</span>: <span class="dv">9</span>,</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>LABELS <span class="op">=</span> [<span class="st">'SEATED_RX'</span>,<span class="st">'STANDING_UP_RX'</span>,<span class="st">'WALKING_TX'</span>,<span class="st">'TURNING_TX'</span>,<span class="st">'SITTING_DOWN_TX'</span>, <span class="st">'SEATED_TX'</span>, <span class="st">'STANDING_UP_TX'</span>,<span class="st">'WALKING_RX'</span>,<span class="st">'TURNING_RX'</span>,<span class="st">'SITTING_DOWN_RX'</span>]</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>NUM_CLASSES <span class="op">=</span> <span class="bu">len</span>(LABELS)</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>TRAIN_IDS <span class="op">=</span> [<span class="st">'e01_rx_tx'</span>, <span class="st">'e01_tx_rx'</span>, <span class="st">'e02_rx_tx'</span>, <span class="st">'e02_tx_rx'</span>, <span class="st">'e03_rx_tx'</span>, <span class="st">'e03_tx_rx'</span>, <span class="st">'e04_rx_tx'</span>, <span class="st">'e04_tx_rx'</span>,</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>             <span class="st">'e05_rx_tx'</span>, <span class="st">'e05_tx_rx'</span>, <span class="st">'e06_rx_tx'</span>, <span class="st">'e06_tx_rx'</span>, <span class="st">'e07_rx_tx'</span>, <span class="st">'e07_tx_rx'</span>, <span class="st">'e08_rx_tx'</span>, <span class="st">'e08_tx_rx'</span>]</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>TEST_IDS <span class="op">=</span> [<span class="st">'e09_rx_tx'</span>, <span class="st">'e09_tx_rx'</span>, <span class="st">'e10_rx_tx'</span>, <span class="st">'e10_tx_rx'</span>]</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>FOLDS <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mlp_model():</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    set_seed()</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> keras.Sequential([</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">128</span>, activation<span class="op">=</span><span class="st">'relu'</span>, input_shape<span class="op">=</span>(<span class="dv">500</span>,)),</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">1024</span>, activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">1024</span>, activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">1024</span>, activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>        layers.Dense(NUM_CLASSES, activation<span class="op">=</span><span class="st">'softmax'</span>)</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">'categorical_crossentropy'</span>, optimizer<span class="op">=</span>keras.optimizers.Adam(learning_rate<span class="op">=</span><span class="fl">0.0005</span>), metrics<span class="op">=</span>[<span class="st">'accuracy'</span>])</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cnn_model():</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    set_seed()</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> keras.Sequential([</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>        layers.Conv2D(filters<span class="op">=</span><span class="dv">128</span>, kernel_size<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">25</span>), input_shape<span class="op">=</span>(<span class="dv">56</span>, <span class="dv">50</span>, <span class="dv">1</span>)),</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>        layers.BatchNormalization(),</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>        layers.Activation(<span class="st">'relu'</span>),</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>        layers.MaxPooling2D(),</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>        layers.Flatten(),</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">512</span>, activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>        layers.Dense(NUM_CLASSES, activation<span class="op">=</span><span class="st">'softmax'</span>)</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">'categorical_crossentropy'</span>, optimizer<span class="op">=</span>keras.optimizers.Adam(learning_rate<span class="op">=</span><span class="fl">0.0001</span>), metrics<span class="op">=</span>[<span class="st">'accuracy'</span>])</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> model_builder(model_type):</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> model_type <span class="op">==</span> <span class="st">'cnn'</span>:</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> cnn_model</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mlp_model</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser()</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--data_dir'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'data directory'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--reports_dir'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'directory to store the generated classification reports'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--model'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'optimize hyperparameters for selected model'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, choices<span class="op">=</span>[<span class="st">'mlp'</span>, <span class="st">'cnn'</span>])</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>    d1_windows, d1_labels <span class="op">=</span> load_data(os.path.join(args.data_dir, <span class="st">'D1'</span>))</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>    d1_labels_cat <span class="op">=</span> ground_truth_to_categorical(d1_labels, MAPPING)    </span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>    x, y <span class="op">=</span> combine_windows(d1_windows, d1_labels_cat)</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Starting 10-fold cross-validation"</span>)</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>    cv_reports <span class="op">=</span> cross_validation(x, y, model_builder(args.model), FOLDS, BATCH_SIZE, EPOCHS, LABELS)</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>    save_json(cv_reports, args.reports_dir, <span class="st">'cv_report.json'</span>)</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Starting D1T training and D1E evaluation"</span>)</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>    (x_d1t, y_d1t), (x_d1e, y_d1e) <span class="op">=</span> split_train_test(d1_windows, d1_labels_cat, TRAIN_IDS, TEST_IDS)</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_builder(args.model)()</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>    model.fit(x_d1t, y_d1t, batch_size<span class="op">=</span>BATCH_SIZE, epochs<span class="op">=</span>EPOCHS, verbose<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>    report <span class="op">=</span> evaluate_model(model, x_d1e, y_d1e, LABELS)</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>    save_json(report, args.reports_dir, <span class="st">'d1_report.json'</span>)</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Starting D2, D3 and D4 evaluation"</span>)</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> eval_dataset <span class="kw">in</span> [<span class="st">'D2'</span>, <span class="st">'D3'</span>, <span class="st">'D4'</span>]:</span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>        windows, labels <span class="op">=</span> load_data(os.path.join(args.data_dir, eval_dataset))</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>        labels_cat <span class="op">=</span> ground_truth_to_categorical(labels, MAPPING)    </span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>        x, y <span class="op">=</span> combine_windows(windows, labels_cat)</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>        report <span class="op">=</span> evaluate_model(model, x, y, LABELS)</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>        save_json(report, args.reports_dir, <span class="ss">f'</span><span class="sc">{</span>eval_dataset<span class="sc">.</span>lower()<span class="sc">}</span><span class="ss">_report.json'</span>)</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
</section>
<section id="verification-of-the-stability-of-the-csi-signal" class="level3">
<h3 class="anchored" data-anchor-id="verification-of-the-stability-of-the-csi-signal">Verification of the stability of the CSI signal</h3>
<p>This section describes the methodology to determine if the CSI data is stable over time carrying out a simple experiment. To do so, a new data collection is executed minimizing the disturbance of the environment by external factors. Then, an evaluation procedure is designed to determine the similarity of CSI samples collected in different time frames using DL classification models.</p>
<section id="methodology-2" class="level4">
<h4 class="anchored" data-anchor-id="methodology-2">Methodology</h4>
<p>A dataset was collected using a TP-Link Archer C80 (one Tx antenna) and a SparkFun Thing Plus ESP32-S3 WROOM (one Rx antenna) connected to a computer. The Tx and Rx were placed on a table, separated by <span class="math inline">\(1\)</span> meter in LOS condition.The Tx device was configured to work with the standard IEEE 802.11n in the channel <span class="math inline">\(6\)</span>. The Rx device was configured to connect to the Rx and extract Wi-Fi CSI data from HT-LTF subcarriers generated by ping traffic at <span class="math inline">\(100\)</span>Hz.</p>
<p>The <strong>data collection</strong> consisted of capturing CSI data from an unaltered laboratory from the university for several days: from March <span class="math inline">\(28^{th}\)</span> to April <span class="math inline">\(1^{st}\)</span> <span class="math inline">\(2024\)</span>, coinciding with the Easter holidays. During these days, no external human factors would have disturbed the environment and thus, the CSI data. The collected CSI samples were labelled regarding the day they were collected (i.e., <span class="math inline">\(03/29\)</span>, <span class="math inline">\(03/29\)</span>, <span class="math inline">\(03/30\)</span>, <span class="math inline">\(03/31\)</span>, <span class="math inline">\(04/01\)</span>).</p>
<p>The <strong>data preparation</strong> steps described in <a href="#sec-csi_data_prep" class="quarto-xref"><span>Data preparation</span></a> with minor adaptations were applied to the dataset. More concretely, given the amount of the collected data (<span class="math inline">\(24\)</span> GB), the windowing procedure was set to arrange windows of size <span class="math inline">\(100\)</span> without overlapping.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The script employed to execute this process is <code>01_4_lodo-dataset-processing.py</code>.</p>
<div data-add-from="libs/chapter5/pipeline/01_4_lodo-dataset-processing.py" data-code-fold="true" data-code-filename="01_4_lodo-dataset-processing.py">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Data preprocessing script for LODO dataset.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">Processes the raw data by aranging samples in windows and process them using DBSCAN for outlier detection</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">and 2-level DWT for threshold based filtering.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">**Example**:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">    $ python 01_4_lodo-dataset-processing.py </span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">        --input_data_path &lt;PATH_OF_RAW_DATA&gt; </span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">        --windowed_data_path &lt;PATH_TO_STORE_RESULTS&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">        --window_size &lt;WINDOW_SIZE&gt;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> copy</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">"../../.."</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> alive_progress <span class="im">import</span> alive_bar</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.processing <span class="im">import</span> proposed_method</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>WINDOW_SIZE <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_windows(dataset, labels, window_size<span class="op">=</span><span class="dv">100</span>):</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    splits <span class="op">=</span> np.arange(window_size, dataset.shape[<span class="dv">1</span>], window_size)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.array(np.split(dataset, splits, axis<span class="op">=</span><span class="dv">1</span>)[:<span class="op">-</span><span class="dv">1</span>]), np.array(np.split(labels, splits, axis<span class="op">=</span><span class="dv">0</span>)[:<span class="op">-</span><span class="dv">1</span>])[:,<span class="dv">0</span>]</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_windows(windows):</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>    windows_copy <span class="op">=</span> copy.deepcopy(windows)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> alive_bar(<span class="bu">len</span>(windows_copy), title<span class="op">=</span><span class="ss">f'Processing windows'</span>, force_tty<span class="op">=</span><span class="va">True</span>, refresh_secs<span class="op">=</span><span class="dv">5</span>) <span class="im">as</span> progress_bar:</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, window <span class="kw">in</span> <span class="bu">enumerate</span>(i, windows_copy):</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>            windows_copy[i] <span class="op">=</span> proposed_method(window)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>            progress_bar()</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> windows_copy</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_windowed_data(data, labels, directory):</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.exists(directory):</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>        os.makedirs(directory)</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    np.save(os.path.join(directory, <span class="st">'</span><span class="sc">{0}</span><span class="st">_x.npy'</span>), data)</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    np.save(os.path.join(directory, <span class="st">'</span><span class="sc">{0}</span><span class="st">_y.npy'</span>), labels)</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser()</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--input_data_path'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Path of input data'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--windowed_data_path'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Path to store windowed data'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--window_size'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'Window size'</span>, required<span class="op">=</span><span class="va">True</span>, default<span class="op">=</span>WINDOW_SIZE)</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    amplitude_files <span class="op">=</span> [<span class="st">'amplitudes_03_28.npy'</span>, <span class="st">'amplitudes_03_29.npy'</span>, <span class="st">'amplitudes_03_30.npy'</span>, <span class="st">'amplitudes_03_31.npy'</span>, <span class="st">'amplitudes_04_01.npy'</span>]</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    labels_files <span class="op">=</span> [<span class="st">'labels_03_28.npy'</span>, <span class="st">'labels_03_29.npy'</span>, <span class="st">'labels_03_30.npy'</span>, <span class="st">'labels_03_31.npy'</span>, <span class="st">'labels_04_01.npy'</span>]</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> amplitude_file, label_file <span class="kw">in</span> <span class="bu">zip</span>(amplitude_files, labels_files):</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Processing dataset </span><span class="sc">{</span>amplitude_file<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> amplitude_file.split(<span class="st">'_'</span>, <span class="dv">1</span>)[<span class="dv">1</span>]</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>        amplitudes <span class="op">=</span> np.load(os.path.join(args.input_data_path, amplitude_file))</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> np.load(os.path.join(args.input_data_path, label_file))</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>        windows, windows_labels <span class="op">=</span> create_windows(amplitudes, labels, args.window_size)</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> amplitudes, labels</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>        windows_processed <span class="op">=</span> process_windows(windows)</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>        save_windowed_data(windows_processed, windows_labels, os.path.join(args.windowed_data_path, name))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
<p>As <strong>HAR classifier</strong>, the model described in <a href="#sec-csi_model" class="quarto-xref"><span>HAR classifier</span></a> was employed, although with minor adaptations in some hyperparameters due to computational limitations caused by the high quantity of data. More concretely, the <strong>number of filters</strong>, <strong>batch size</strong> and <strong>epochs</strong> were set to <span class="math inline">\(8\)</span>, <span class="math inline">\(512\)</span> and <span class="math inline">\(30\)</span>, respectively.</p>
<p>Finally, the <strong>experimental procedure</strong> consisted of a <span class="math inline">\(5\)</span>-fold cross-validation with the processed dataset. Each fold of the cross-validation corresponds to the data collected in one day, which can be named as Leaving-One-Day-Out (LODO). This procedure aims to evaluate how the models classify data from an unseen day, having two possible outputs:</p>
<ul>
<li>The samples from a specific day are classified in any of the remaining days. In other words, a specific day’s samples are similar to those of any other day. These results would imply that the CSI data <strong>is stable</strong> over time.</li>
<li>The samples from the day <span class="math inline">\(X_i\)</span> are classified in the day <span class="math inline">\(X_{i-1}\)</span> or <span class="math inline">\(X_{i+1}\)</span>. In other words, samples from a specific day are similar only to the adjacent days (i.e., samples most close in time). These results would imply that the CSI data <strong>is not stable</strong> over time.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The script employed to execute this process is <code>03_3_lodo.py</code>.</p>
<div data-add-from="libs/chapter5/pipeline/03_3_lodo.py" data-code-fold="true" data-code-filename="03_3_lodo.py">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Leaving-One-Day-Out validation script</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">Performs a Leaving-One-Day-Out evaluation on the LODO dataset.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">**Example**:</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">    $ python 03_3_lodo.py </span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">        --data_dir &lt;PATH_OF_DATA&gt; </span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">        --reports_dir &lt;PATH_TO_STORE_REPORTS&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> argparse</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>sys.path.append(<span class="st">"../../.."</span>)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.utils <span class="im">import</span> to_categorical</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.chapter5.pipeline.ml <span class="im">import</span> evaluate_model</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> libs.common.utils <span class="im">import</span> save_json, set_seed</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>MAPPING <span class="op">=</span> {</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'03/28'</span>: <span class="dv">0</span>,</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'03/29'</span>: <span class="dv">1</span>,</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'03/30'</span>: <span class="dv">2</span>,</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'03/31'</span>: <span class="dv">3</span>,</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'04/01'</span>: <span class="dv">4</span>,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>LABELS <span class="op">=</span> [<span class="st">'03/28'</span>, <span class="st">'03/29'</span>, <span class="st">'03/30'</span>, <span class="st">'03/31'</span>, <span class="st">'04/01'</span>]</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>NUM_CLASSES <span class="op">=</span> <span class="bu">len</span>(LABELS)</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>BATCH_SIZE <span class="op">=</span> <span class="dv">512</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>EPOCHS <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> build_model():</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    set_seed()</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> keras.Sequential([</span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>        layers.Conv2D(filters<span class="op">=</span><span class="dv">8</span>, kernel_size<span class="op">=</span>(<span class="dv">5</span>,<span class="dv">25</span>), input_shape<span class="op">=</span>(<span class="dv">56</span>, <span class="dv">100</span>, <span class="dv">1</span>)),</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>        layers.BatchNormalization(),</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>        layers.Activation(<span class="st">'relu'</span>),</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>        layers.MaxPooling2D(),</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>        layers.Flatten(),</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>        layers.Dense(<span class="dv">512</span>, activation<span class="op">=</span><span class="st">'relu'</span>),</span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>        layers.Dense(NUM_CLASSES, activation<span class="op">=</span><span class="st">'softmax'</span>)</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>    model.<span class="bu">compile</span>(loss<span class="op">=</span><span class="st">'categorical_crossentropy'</span>, optimizer<span class="op">=</span>keras.optimizers.Adam(learning_rate<span class="op">=</span><span class="fl">0.0001</span>), metrics<span class="op">=</span>[<span class="st">'accuracy'</span>])</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model</span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_models(datasets, labels, batch_size<span class="op">=</span>BATCH_SIZE, epochs<span class="op">=</span>EPOCHS, verbose<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>    reports <span class="op">=</span> []</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(datasets)):</span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>        training_datasets <span class="op">=</span> [datasets[j] <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(datasets)) <span class="cf">if</span> j <span class="op">!=</span> i]</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>        training_labels <span class="op">=</span> [labels[j] <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(labels)) <span class="cf">if</span> j <span class="op">!=</span> i]</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Training with: </span><span class="sc">{</span>training_labels<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Testing with: </span><span class="sc">{</span>labels[i]<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>        x_train <span class="op">=</span> np.vstack(training_datasets)</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>        y_train <span class="op">=</span> one_hot_encoding(np.concatenate(training_labels), MAPPING)</span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>        x_test <span class="op">=</span> datasets[i]</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>        y_test <span class="op">=</span> one_hot_encoding(labels[i], MAPPING)</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> build_model()</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>        model.fit(x_train, y_train, batch_size<span class="op">=</span>batch_size, epochs<span class="op">=</span>epochs, verbose<span class="op">=</span>verbose)</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>        report <span class="op">=</span> evaluate_model(model, x_test, y_test, LABELS)</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>        reports.append(report)</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> x_train</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> y_train</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> x_test</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> y_test</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> training_datasets</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> training_labels</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>        <span class="kw">del</span> model</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> reports</span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> one_hot_encoding(y, mapping):</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> to_categorical(<span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> i: mapping[i], y)), num_classes<span class="op">=</span><span class="bu">len</span>(mapping.keys()))    </span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>    parser <span class="op">=</span> argparse.ArgumentParser()</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--data_dir'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'data directory'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>    parser.add_argument(<span class="st">'--reports_dir'</span>, <span class="bu">help</span><span class="op">=</span><span class="st">'directory to store the generated classification reports'</span>, <span class="bu">type</span><span class="op">=</span><span class="bu">str</span>, required<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>    args <span class="op">=</span> parser.parse_args()</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>    windows <span class="op">=</span> []</span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>    labels <span class="op">=</span> []</span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> day <span class="kw">in</span> [<span class="st">'03_28'</span>, <span class="st">'03_29'</span>, <span class="st">'03_30'</span>, <span class="st">'03_31'</span>, <span class="st">'04_01'</span>]:</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>        windows.append(np.load(os.path.join(args.data_dir), <span class="ss">f'</span><span class="sc">{</span>day<span class="sc">}</span><span class="ss">_x.npy'</span>))</span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>        labels.append(np.load(os.path.join(args.data_dir), <span class="ss">f'</span><span class="sc">{</span>day<span class="sc">}</span><span class="ss">_y.npy'</span>))</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>    reports <span class="op">=</span> train_models(windows, labels)</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>    save_json(reports, args.reports_dir, <span class="st">'reports.json'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<div id="listing-contents" class="quarto-listing quarto-listing-container-grid">
<div class="list grid quarto-listing-cols-3">
<div class="g-col-1" data-index="0" data-listing-file-modified-sort="1730374316288" data-listing-reading-time-sort="4" data-listing-word-count-sort="641">
<a href="./05.1_localized-har.html" class="quarto-grid-link">
<div class="quarto-grid-item card h-100 card-left">
<p class="card-img-top">
<img loading="lazy" src="./figs/chapter5/confusion-matrixes.png" class="thumbnail-image card-img" style="height: 150px;">
</p>
<div class="card-body post-contents">
<h5 class="no-anchor card-title listing-title">
Localized HAR based on Wi-Fi CSI
</h5>
<div class="card-text listing-description">
Presents the preliminary results on localized HAR using Wi-Fi CSI.
</div>
<div class="card-attribution card-text-small start">
<div class="listing-author">

</div>
</div>
</div>
</div>
</a>
</div>
<div class="g-col-1" data-index="1" data-listing-file-modified-sort="1721644249235" data-listing-reading-time-sort="3" data-listing-word-count-sort="458">
<a href="./05.2_methods-validation.html" class="quarto-grid-link">
<div class="quarto-grid-item card h-100 card-left">
<p class="card-img-top">
<img loading="lazy" src="./figs/chapter5/validation.png" class="thumbnail-image card-img" style="height: 150px;">
</p>
<div class="card-body post-contents">
<h5 class="no-anchor card-title listing-title">
Validation of employed methods
</h5>
<div class="card-text listing-description">
Validates the employed methods in the previous sections to discard them as causes of the poor results.
</div>
<div class="card-attribution card-text-small start">
<div class="listing-author">

</div>
</div>
</div>
</div>
</a>
</div>
<div class="g-col-1" data-index="2" data-listing-file-modified-sort="1730374323635" data-listing-reading-time-sort="2" data-listing-word-count-sort="308">
<a href="./05.3_csi-stability.html" class="quarto-grid-link">
<div class="quarto-grid-item card h-100 card-left">
<p class="card-img-top">
<img loading="lazy" src="./figs/chapter5/cf-lodo.png" class="thumbnail-image card-img" style="height: 150px;">
</p>
<div class="card-body post-contents">
<h5 class="no-anchor card-title listing-title">
Temporal stability of Wi-Fi CSI data from ESP32 microcontrollers
</h5>
<div class="card-text listing-description">
Analyses the temporal stability of the Wi-Fi CSI data collected with ESP32 microcontrollers.
</div>
<div class="card-attribution card-text-small start">
<div class="listing-author">

</div>
</div>
</div>
</div>
</a>
</div>
</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div>



<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-alsaify2020dataset" class="csl-entry" role="listitem">
Alsaify, Baha A, Mahmoud M Almazari, Rami Alazrai, and Mohammad I Daoud. 2020. <span>“A Dataset for Wi-Fi-Based Human Activity Recognition in Line-of-Sight and Non-Line-of-Sight Indoor Environments.”</span> <em>Data in Brief</em> 33: 106534. <a href="https://doi.org/10.1016/j.dib.2020.106534">https://doi.org/10.1016/j.dib.2020.106534</a>.
</div>
<div id="ref-choi2022wi" class="csl-entry" role="listitem">
Choi, Hyuckjin, Manato Fujimoto, Tomokazu Matsui, Shinya Misaki, and Keiichi Yasumoto. 2022. <span>“Wi-CaL: WiFi Sensing and Machine Learning Based Device-Free Crowd Counting and Localization.”</span> <em>IEEE Access</em> 10: 24395–410. <a href="https://doi.org/10.1109/ACCESS.2022.3155812">https://doi.org/10.1109/ACCESS.2022.3155812</a>.
</div>
<div id="ref-ester1996density" class="csl-entry" role="listitem">
Ester, Martin, Hans-Peter Kriegel, Jörg Sander, Xiaowei Xu, et al. 1996. <span>“A Density-Based Algorithm for Discovering Clusters in Large Spatial Databases with Noise.”</span> In <em>Kdd</em>, 96:226–31. 34.
</div>
<div id="ref-ma2019wifi" class="csl-entry" role="listitem">
Ma, Yongsen, Gang Zhou, and Shuangquan Wang. 2019. <span>“WiFi Sensing with Channel State Information: A Survey.”</span> <em>ACM Comput. Surv.</em> 52 (3): 1–36. <a href="https://doi.org/10.1145/3310194">https://doi.org/10.1145/3310194</a>.
</div>
<div id="ref-matey2023csi" class="csl-entry" role="listitem">
Matey-Sanz, Miguel, Joaquín Torres-Sospedra, and Adriano Moreira. 2023. <span>“Temporal Stability on Human Activity Recognition Based on Wi-Fi CSI.”</span> In <em>2023 13th International Conference on Indoor Positioning and Indoor Navigation (IPIN)</em>, 1–6. <a href="https://doi.org/10.1109/IPIN57070.2023.10332214">https://doi.org/10.1109/IPIN57070.2023.10332214</a>.
</div>
<div id="ref-yousefi2017survey" class="csl-entry" role="listitem">
Yousefi, Siamak, Hirokazu Narui, Sankalp Dayal, Stefano Ermon, and Shahrokh Valaee. 2017. <span>“A Survey on Behavior Recognition Using WiFi Channel State Information.”</span> <em>IEEE Communications Magazine</em> 55 (10): 98–104. <a href="https://doi.org/10.1109/MCOM.2017.1700082">https://doi.org/10.1109/MCOM.2017.1700082</a>.
</div>
</div>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04.3_energy-consumption.html" class="pagination-link" aria-label="Energy consumption">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Energy consumption</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./05.1_localized-har.html" class="pagination-link" aria-label="Localized HAR based on Wi-Fi CSI">
        <span class="nav-page-text"><span class="chapter-title">Localized HAR based on Wi-Fi CSI</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><em>Human Activity Recognition with Consumer Devices and Real-Life Perspectives</em> <br> Licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> © Miguel Matey Sanz, 2024</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/matey97/thesis/blob/main/05_wifi-csi.qmd" target="blank" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This book was built with ❤️ and <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"selector":".lightbox","openEffect":"zoom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
<script src="site_libs/quarto-contrib/add-code-files-1.0.0/add-code-files.js"></script>
</body></html>